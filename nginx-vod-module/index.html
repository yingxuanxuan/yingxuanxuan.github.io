
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Linux学习笔记，Python学习笔记，Android学习笔记，前端学习笔记，nginx， nginx-vod-module，ffmpeg，pyqt，qt，Javascript，vue等">
      
      
        <link rel="canonical" href="https://yingxuanxuan.com/nginx-vod-module/">
      
      
        <meta name="author" content="yingxuanxuan">
      
      
        <link rel="shortcut icon" href="../img/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.0.5">
    
    
      
        <title>Nginx-vod-module - yingxuanxuan.com</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-9c62e3c932.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02ce7adcc2.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="blue" data-md-color-accent="lime">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="yingxuanxuan.com" class=" md-logo  md-header-nav__button">
          
            <img src="../img/favicon.ico" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  学习笔记
                </span>
              
                <span class="md-header-nav__parent">
                  Linux
                </span>
              
            
            Nginx-vod-module
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/yingxuanxuan/yingxuanxuan.github.io" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../img/favicon.ico">
      
    </i>
    yingxuanxuan.com
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/yingxuanxuan/yingxuanxuan.github.io" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href=".." title="首页" class="md-nav__link">
        首页
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      学习笔记
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        学习笔记
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2-1">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../linux/" title="Linux" class="md-nav__link">
        Linux
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../nginx/" title="Ningx" class="md-nav__link">
        Ningx
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Nginx-vod-module
      </label>
    
    <a href="./" title="Nginx-vod-module" class="md-nav__link md-nav__link--active">
      Nginx-vod-module
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="特性" class="md-nav__link">
    特性
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="实际测试支持文件格式" class="md-nav__link">
    实际测试支持文件格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="最佳视频参数" class="md-nav__link">
    最佳视频参数
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="建议的视频设置" class="md-nav__link">
    建议的视频设置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quicktime-mpeg-4" title="QuickTime MPEG-4 设置建议" class="md-nav__link">
    QuickTime MPEG-4 设置建议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="不同视频尺寸建议码率" class="md-nav__link">
    不同视频尺寸建议码率
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="建议的音频编码设置" class="md-nav__link">
    建议的音频编码设置
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-multi-device-transcoding" title="Best Practices For Multi-Device Transcoding" class="md-nav__link">
    Best Practices For Multi-Device Transcoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ngx_http_hls" title="ngx_http_hls支持的文件格式与编码格式" class="md-nav__link">
    ngx_http_hls支持的文件格式与编码格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="支持文件格式" class="md-nav__link">
    支持文件格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="通常后缀名" class="md-nav__link">
    通常后缀名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="支持编码格式" class="md-nav__link">
    支持编码格式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="限制" class="md-nav__link">
    限制
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="安装" class="md-nav__link">
    安装
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" title="编译" class="md-nav__link">
    编译
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rhelcentos-rpm" title="RHEL/CentOS RPM" class="md-nav__link">
    RHEL/CentOS RPM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rhel-or-centos-6" title="RHEL or CentOS 6" class="md-nav__link">
    RHEL or CentOS 6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rhel-or-centos-7" title="RHEL or CentOS 7" class="md-nav__link">
    RHEL or CentOS 7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debianubuntu-rpm" title="Debian/Ubuntu RPM" class="md-nav__link">
    Debian/Ubuntu RPM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" title="注意" class="md-nav__link">
    注意
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" title="URL结构" class="md-nav__link">
    URL结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url_1" title="基本URL结构" class="md-nav__link">
    基本URL结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" title="结构" class="md-nav__link">
    结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fileuri" title="fileuri" class="md-nav__link">
    fileuri
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_2" title="多文件合一URL结构" class="md-nav__link">
    多文件合一URL结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" title="多合一" class="md-nav__link">
    多合一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" title="分解" class="md-nav__link">
    分解
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" title="注意" class="md-nav__link">
    注意
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_3" title="URL路径参数" class="md-nav__link">
    URL路径参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" title="文件名结构" class="md-nav__link">
    文件名结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" title="结构" class="md-nav__link">
    结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basename" title="basename" class="md-nav__link">
    basename
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seqparams-sseq" title="seqparams （sseq）" class="md-nav__link">
    seqparams （sseq）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fileparams-f" title="fileparams （f）" class="md-nav__link">
    fileparams （f）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trackparams-t" title="trackparams （t）" class="md-nav__link">
    trackparams （t）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#langparams" title="langparams" class="md-nav__link">
    langparams
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mappingjson" title="Mapping模式JSON响应格式" class="md-nav__link">
    Mapping模式JSON响应格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" title="示例字段说明准备" class="md-nav__link">
    示例字段说明准备
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" title="示例：简单映射" class="md-nav__link">
    示例：简单映射
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" title="示例：自适应集合" class="md-nav__link">
    示例：自适应集合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" title="示例：播放列表" class="md-nav__link">
    示例：播放列表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" title="示例：过滤器" class="md-nav__link">
    示例：过滤器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" title="示例：连续直播" class="md-nav__link">
    示例：连续直播
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" title="示例：不连续直播" class="md-nav__link">
    示例：不连续直播
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping" title="Mapping模式参数说明" class="md-nav__link">
    Mapping模式参数说明
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set" title="Set" class="md-nav__link">
    Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence" title="Sequence" class="md-nav__link">
    Sequence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clipabstract" title="Clip（abstract）" class="md-nav__link">
    Clip（abstract）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-clip" title="Source clip" class="md-nav__link">
    Source clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-filter-clip" title="Rate filter clip" class="md-nav__link">
    Rate filter clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gain-filter-clip" title="Gain filter clip" class="md-nav__link">
    Gain filter clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mix-filter-clip" title="Mix filter clip" class="md-nav__link">
    Mix filter clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concat-clip" title="Concat clip" class="md-nav__link">
    Concat clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-clip" title="Dynamic clip" class="md-nav__link">
    Dynamic clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification" title="Notification" class="md-nav__link">
    Notification
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" title="安全" class="md-nav__link">
    安全
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" title="鉴权" class="md-nav__link">
    鉴权
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cdn" title="CDN分发" class="md-nav__link">
    CDN分发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" title="直接分发" class="md-nav__link">
    直接分发
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_4" title="URL加密" class="md-nav__link">
    URL加密
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" title="多媒体加密" class="md-nav__link">
    多媒体加密
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drm" title="DRM" class="md-nav__link">
    DRM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" title="性能建议" class="md-nav__link">
    性能建议
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" title="配置" class="md-nav__link">
    配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" title="配置示例" class="md-nav__link">
    配置示例
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" title="Local模式" class="md-nav__link">
    Local模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapped" title="Mapped模式" class="md-nav__link">
    Mapped模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote" title="Remote模式" class="md-nav__link">
    Remote模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx" title="Nginx变量" class="md-nav__link">
    Nginx变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" title="配置指令：基础" class="md-nav__link">
    配置指令：基础
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod" title="vod 分段模式" class="md-nav__link">
    vod 分段模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_mode" title="vod_mode 模式" class="md-nav__link">
    vod_mode 模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_status" title="vod_status 开启监控" class="md-nav__link">
    vod_status 开启监控
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentation" title="配置指令：segmentation分段" class="md-nav__link">
    配置指令：segmentation分段
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod_segment_duration" title="vod_segment_duration 分段时长" class="md-nav__link">
    vod_segment_duration 分段时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_live_window_duration" title="vod_live_window_duration 直播窗口时长" class="md-nav__link">
    vod_live_window_duration 直播窗口时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_bootstrap_segment_durations" title="vod_bootstrap_segment_durations 启动分段时长" class="md-nav__link">
    vod_bootstrap_segment_durations 启动分段时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_align_segments_to_key_frames" title="vod_align_segments_to_key_frames 分段由关键帧开始" class="md-nav__link">
    vod_align_segments_to_key_frames 分段由关键帧开始
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_segment_count_policy" title="vod_segment_count_policy 分段计数策略" class="md-nav__link">
    vod_segment_count_policy 分段计数策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_manifest_segment_durations_mode-manifest" title="vod_manifest_segment_durations_mode manifest文件分段时长准确度模式" class="md-nav__link">
    vod_manifest_segment_durations_mode manifest文件分段时长准确度模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upstream" title="配置指令：upstream" class="md-nav__link">
    配置指令：upstream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback" title="配置指令：fallback" class="md-nav__link">
    配置指令：fallback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" title="配置指令：性能" class="md-nav__link">
    配置指令：性能
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod_metadata_cache" title="vod_metadata_cache 视频分段缓存" class="md-nav__link">
    vod_metadata_cache 视频分段缓存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_mapping_cache" title="vod_mapping_cache" class="md-nav__link">
    vod_mapping_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_live_mapping_cache" title="vod_live_mapping_cache" class="md-nav__link">
    vod_live_mapping_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_response_cache" title="vod_response_cache" class="md-nav__link">
    vod_response_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_live_response_cache" title="vod_live_response_cache" class="md-nav__link">
    vod_live_response_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_initial_read_size" title="vod_initial_read_size 初始读取大小" class="md-nav__link">
    vod_initial_read_size 初始读取大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_max_metadata_size" title="vod_max_metadata_size 最大支持视频元数据大小" class="md-nav__link">
    vod_max_metadata_size 最大支持视频元数据大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_max_frames_size" title="vod_max_frames_size 最大帧大小" class="md-nav__link">
    vod_max_frames_size 最大帧大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_cache_buffer_size" title="vod_cache_buffer_size" class="md-nav__link">
    vod_cache_buffer_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_open_file_thread_pool" title="vod_open_file_thread_pool" class="md-nav__link">
    vod_open_file_thread_pool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_output_buffer_pool-http" title="vod_output_buffer_pool HTTP响应内存池" class="md-nav__link">
    vod_output_buffer_pool HTTP响应内存池
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_performance_counters" title="vod_performance_counters" class="md-nav__link">
    vod_performance_counters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_5" title="配置指令：url结构" class="md-nav__link">
    配置指令：url结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" title="配置指令：响应头部" class="md-nav__link">
    配置指令：响应头部
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-stitching-mapped-mode-only" title="配置指令：ad stitching (mapped mode only)" class="md-nav__link">
    配置指令：ad stitching (mapped mode only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drm-encryption" title="配置指令：DRM / encryption" class="md-nav__link">
    配置指令：DRM / encryption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dash" title="配置指令：DASH" class="md-nav__link">
    配置指令：DASH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hds" title="配置指令：HDS" class="md-nav__link">
    配置指令：HDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hls" title="配置指令：HLS" class="md-nav__link">
    配置指令：HLS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_method" title="vod_hls_encryption_method" class="md-nav__link">
    vod_hls_encryption_method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_absolute_master_urls-manifesturl" title="vod_hls_absolute_master_urls 设置manifest文件url相对/绝对" class="md-nav__link">
    vod_hls_absolute_master_urls 设置manifest文件url相对/绝对
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_absolute_index_urls-manifesturl" title="vod_hls_absolute_index_urls 设置manifest文件url相对/绝对" class="md-nav__link">
    vod_hls_absolute_index_urls 设置manifest文件url相对/绝对
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_absolute_iframe_urls" title="vod_hls_absolute_iframe_urls" class="md-nav__link">
    vod_hls_absolute_iframe_urls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_master_file_name_prefix" title="vod_hls_master_file_name_prefix" class="md-nav__link">
    vod_hls_master_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_index_file_name_prefix" title="vod_hls_index_file_name_prefix" class="md-nav__link">
    vod_hls_index_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_iframes_file_name_prefix" title="vod_hls_iframes_file_name_prefix" class="md-nav__link">
    vod_hls_iframes_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_segment_file_name_prefix" title="vod_hls_segment_file_name_prefix" class="md-nav__link">
    vod_hls_segment_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_file_name" title="vod_hls_encryption_key_file_name" class="md-nav__link">
    vod_hls_encryption_key_file_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_uri" title="vod_hls_encryption_key_uri" class="md-nav__link">
    vod_hls_encryption_key_uri
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_format" title="vod_hls_encryption_key_format" class="md-nav__link">
    vod_hls_encryption_key_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_format_versions" title="vod_hls_encryption_key_format_versions" class="md-nav__link">
    vod_hls_encryption_key_format_versions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_interleave_frames" title="vod_hls_interleave_frames 音视频交叉分包" class="md-nav__link">
    vod_hls_interleave_frames 音视频交叉分包
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_align_frames" title="vod_hls_align_frames 音视频帧对齐" class="md-nav__link">
    vod_hls_align_frames 音视频帧对齐
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_output_id3_timestamps" title="vod_hls_output_id3_timestamps" class="md-nav__link">
    vod_hls_output_id3_timestamps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mss" title="配置指令：MSS" class="md-nav__link">
    配置指令：MSS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" title="配置指令：缩略图截取" class="md-nav__link">
    配置指令：缩略图截取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc" title="配置指令：misc 混合" class="md-nav__link">
    配置指令：misc 混合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../ffmpeg/" title="FFmpeg" class="md-nav__link">
        FFmpeg
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2-2">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../python/" title="Python" class="md-nav__link">
        Python
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../flask/" title="Flask" class="md-nav__link">
        Flask
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../pyqt/" title="PyQt/Qt" class="md-nav__link">
        PyQt/Qt
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../mkdocs/" title="mkdocs" class="md-nav__link">
        mkdocs
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Android
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2-3">
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../android/" title="Android" class="md-nav__link">
        Android
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Javascript
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2-4">
        Javascript
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../javascript/" title="Javascript" class="md-nav__link">
        Javascript
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../vue/" title="Vue" class="md-nav__link">
        Vue
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="特性" class="md-nav__link">
    特性
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="实际测试支持文件格式" class="md-nav__link">
    实际测试支持文件格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="最佳视频参数" class="md-nav__link">
    最佳视频参数
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="建议的视频设置" class="md-nav__link">
    建议的视频设置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quicktime-mpeg-4" title="QuickTime MPEG-4 设置建议" class="md-nav__link">
    QuickTime MPEG-4 设置建议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="不同视频尺寸建议码率" class="md-nav__link">
    不同视频尺寸建议码率
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="建议的音频编码设置" class="md-nav__link">
    建议的音频编码设置
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-multi-device-transcoding" title="Best Practices For Multi-Device Transcoding" class="md-nav__link">
    Best Practices For Multi-Device Transcoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ngx_http_hls" title="ngx_http_hls支持的文件格式与编码格式" class="md-nav__link">
    ngx_http_hls支持的文件格式与编码格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="支持文件格式" class="md-nav__link">
    支持文件格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="通常后缀名" class="md-nav__link">
    通常后缀名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="支持编码格式" class="md-nav__link">
    支持编码格式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="限制" class="md-nav__link">
    限制
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="安装" class="md-nav__link">
    安装
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" title="编译" class="md-nav__link">
    编译
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rhelcentos-rpm" title="RHEL/CentOS RPM" class="md-nav__link">
    RHEL/CentOS RPM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rhel-or-centos-6" title="RHEL or CentOS 6" class="md-nav__link">
    RHEL or CentOS 6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rhel-or-centos-7" title="RHEL or CentOS 7" class="md-nav__link">
    RHEL or CentOS 7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debianubuntu-rpm" title="Debian/Ubuntu RPM" class="md-nav__link">
    Debian/Ubuntu RPM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" title="注意" class="md-nav__link">
    注意
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" title="URL结构" class="md-nav__link">
    URL结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#url_1" title="基本URL结构" class="md-nav__link">
    基本URL结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" title="结构" class="md-nav__link">
    结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fileuri" title="fileuri" class="md-nav__link">
    fileuri
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_2" title="多文件合一URL结构" class="md-nav__link">
    多文件合一URL结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" title="多合一" class="md-nav__link">
    多合一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" title="分解" class="md-nav__link">
    分解
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" title="注意" class="md-nav__link">
    注意
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_3" title="URL路径参数" class="md-nav__link">
    URL路径参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" title="文件名结构" class="md-nav__link">
    文件名结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" title="结构" class="md-nav__link">
    结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basename" title="basename" class="md-nav__link">
    basename
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seqparams-sseq" title="seqparams （sseq）" class="md-nav__link">
    seqparams （sseq）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fileparams-f" title="fileparams （f）" class="md-nav__link">
    fileparams （f）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trackparams-t" title="trackparams （t）" class="md-nav__link">
    trackparams （t）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#langparams" title="langparams" class="md-nav__link">
    langparams
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mappingjson" title="Mapping模式JSON响应格式" class="md-nav__link">
    Mapping模式JSON响应格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" title="示例字段说明准备" class="md-nav__link">
    示例字段说明准备
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" title="示例：简单映射" class="md-nav__link">
    示例：简单映射
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" title="示例：自适应集合" class="md-nav__link">
    示例：自适应集合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" title="示例：播放列表" class="md-nav__link">
    示例：播放列表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" title="示例：过滤器" class="md-nav__link">
    示例：过滤器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" title="示例：连续直播" class="md-nav__link">
    示例：连续直播
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" title="示例：不连续直播" class="md-nav__link">
    示例：不连续直播
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping" title="Mapping模式参数说明" class="md-nav__link">
    Mapping模式参数说明
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set" title="Set" class="md-nav__link">
    Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence" title="Sequence" class="md-nav__link">
    Sequence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clipabstract" title="Clip（abstract）" class="md-nav__link">
    Clip（abstract）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-clip" title="Source clip" class="md-nav__link">
    Source clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-filter-clip" title="Rate filter clip" class="md-nav__link">
    Rate filter clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gain-filter-clip" title="Gain filter clip" class="md-nav__link">
    Gain filter clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mix-filter-clip" title="Mix filter clip" class="md-nav__link">
    Mix filter clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concat-clip" title="Concat clip" class="md-nav__link">
    Concat clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-clip" title="Dynamic clip" class="md-nav__link">
    Dynamic clip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notification" title="Notification" class="md-nav__link">
    Notification
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" title="安全" class="md-nav__link">
    安全
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" title="鉴权" class="md-nav__link">
    鉴权
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cdn" title="CDN分发" class="md-nav__link">
    CDN分发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" title="直接分发" class="md-nav__link">
    直接分发
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_4" title="URL加密" class="md-nav__link">
    URL加密
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" title="多媒体加密" class="md-nav__link">
    多媒体加密
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drm" title="DRM" class="md-nav__link">
    DRM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" title="性能建议" class="md-nav__link">
    性能建议
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" title="配置" class="md-nav__link">
    配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" title="配置示例" class="md-nav__link">
    配置示例
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" title="Local模式" class="md-nav__link">
    Local模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapped" title="Mapped模式" class="md-nav__link">
    Mapped模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote" title="Remote模式" class="md-nav__link">
    Remote模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx" title="Nginx变量" class="md-nav__link">
    Nginx变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" title="配置指令：基础" class="md-nav__link">
    配置指令：基础
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod" title="vod 分段模式" class="md-nav__link">
    vod 分段模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_mode" title="vod_mode 模式" class="md-nav__link">
    vod_mode 模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_status" title="vod_status 开启监控" class="md-nav__link">
    vod_status 开启监控
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentation" title="配置指令：segmentation分段" class="md-nav__link">
    配置指令：segmentation分段
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod_segment_duration" title="vod_segment_duration 分段时长" class="md-nav__link">
    vod_segment_duration 分段时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_live_window_duration" title="vod_live_window_duration 直播窗口时长" class="md-nav__link">
    vod_live_window_duration 直播窗口时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_bootstrap_segment_durations" title="vod_bootstrap_segment_durations 启动分段时长" class="md-nav__link">
    vod_bootstrap_segment_durations 启动分段时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_align_segments_to_key_frames" title="vod_align_segments_to_key_frames 分段由关键帧开始" class="md-nav__link">
    vod_align_segments_to_key_frames 分段由关键帧开始
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_segment_count_policy" title="vod_segment_count_policy 分段计数策略" class="md-nav__link">
    vod_segment_count_policy 分段计数策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_manifest_segment_durations_mode-manifest" title="vod_manifest_segment_durations_mode manifest文件分段时长准确度模式" class="md-nav__link">
    vod_manifest_segment_durations_mode manifest文件分段时长准确度模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upstream" title="配置指令：upstream" class="md-nav__link">
    配置指令：upstream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback" title="配置指令：fallback" class="md-nav__link">
    配置指令：fallback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" title="配置指令：性能" class="md-nav__link">
    配置指令：性能
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod_metadata_cache" title="vod_metadata_cache 视频分段缓存" class="md-nav__link">
    vod_metadata_cache 视频分段缓存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_mapping_cache" title="vod_mapping_cache" class="md-nav__link">
    vod_mapping_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_live_mapping_cache" title="vod_live_mapping_cache" class="md-nav__link">
    vod_live_mapping_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_response_cache" title="vod_response_cache" class="md-nav__link">
    vod_response_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_live_response_cache" title="vod_live_response_cache" class="md-nav__link">
    vod_live_response_cache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_initial_read_size" title="vod_initial_read_size 初始读取大小" class="md-nav__link">
    vod_initial_read_size 初始读取大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_max_metadata_size" title="vod_max_metadata_size 最大支持视频元数据大小" class="md-nav__link">
    vod_max_metadata_size 最大支持视频元数据大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_max_frames_size" title="vod_max_frames_size 最大帧大小" class="md-nav__link">
    vod_max_frames_size 最大帧大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_cache_buffer_size" title="vod_cache_buffer_size" class="md-nav__link">
    vod_cache_buffer_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_open_file_thread_pool" title="vod_open_file_thread_pool" class="md-nav__link">
    vod_open_file_thread_pool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_output_buffer_pool-http" title="vod_output_buffer_pool HTTP响应内存池" class="md-nav__link">
    vod_output_buffer_pool HTTP响应内存池
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_performance_counters" title="vod_performance_counters" class="md-nav__link">
    vod_performance_counters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_5" title="配置指令：url结构" class="md-nav__link">
    配置指令：url结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" title="配置指令：响应头部" class="md-nav__link">
    配置指令：响应头部
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ad-stitching-mapped-mode-only" title="配置指令：ad stitching (mapped mode only)" class="md-nav__link">
    配置指令：ad stitching (mapped mode only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drm-encryption" title="配置指令：DRM / encryption" class="md-nav__link">
    配置指令：DRM / encryption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dash" title="配置指令：DASH" class="md-nav__link">
    配置指令：DASH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hds" title="配置指令：HDS" class="md-nav__link">
    配置指令：HDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hls" title="配置指令：HLS" class="md-nav__link">
    配置指令：HLS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_method" title="vod_hls_encryption_method" class="md-nav__link">
    vod_hls_encryption_method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_absolute_master_urls-manifesturl" title="vod_hls_absolute_master_urls 设置manifest文件url相对/绝对" class="md-nav__link">
    vod_hls_absolute_master_urls 设置manifest文件url相对/绝对
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_absolute_index_urls-manifesturl" title="vod_hls_absolute_index_urls 设置manifest文件url相对/绝对" class="md-nav__link">
    vod_hls_absolute_index_urls 设置manifest文件url相对/绝对
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_absolute_iframe_urls" title="vod_hls_absolute_iframe_urls" class="md-nav__link">
    vod_hls_absolute_iframe_urls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_master_file_name_prefix" title="vod_hls_master_file_name_prefix" class="md-nav__link">
    vod_hls_master_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_index_file_name_prefix" title="vod_hls_index_file_name_prefix" class="md-nav__link">
    vod_hls_index_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_iframes_file_name_prefix" title="vod_hls_iframes_file_name_prefix" class="md-nav__link">
    vod_hls_iframes_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_segment_file_name_prefix" title="vod_hls_segment_file_name_prefix" class="md-nav__link">
    vod_hls_segment_file_name_prefix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_file_name" title="vod_hls_encryption_key_file_name" class="md-nav__link">
    vod_hls_encryption_key_file_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_uri" title="vod_hls_encryption_key_uri" class="md-nav__link">
    vod_hls_encryption_key_uri
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_format" title="vod_hls_encryption_key_format" class="md-nav__link">
    vod_hls_encryption_key_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_encryption_key_format_versions" title="vod_hls_encryption_key_format_versions" class="md-nav__link">
    vod_hls_encryption_key_format_versions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_interleave_frames" title="vod_hls_interleave_frames 音视频交叉分包" class="md-nav__link">
    vod_hls_interleave_frames 音视频交叉分包
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_align_frames" title="vod_hls_align_frames 音视频帧对齐" class="md-nav__link">
    vod_hls_align_frames 音视频帧对齐
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vod_hls_output_id3_timestamps" title="vod_hls_output_id3_timestamps" class="md-nav__link">
    vod_hls_output_id3_timestamps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mss" title="配置指令：MSS" class="md-nav__link">
    配置指令：MSS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" title="配置指令：缩略图截取" class="md-nav__link">
    配置指令：缩略图截取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc" title="配置指令：misc 混合" class="md-nav__link">
    配置指令：misc 混合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/yingxuanxuan/yingxuanxuan.github.io/edit/master/docs/nginx-vod-module.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                  <h1>Nginx-vod-module</h1>
                
                <h2 id="_1">特性<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>实时将MP4转换为DASH，HDS，HLS，MSS<br />
工作模式1：Local本地模式，使用本地文件提供服务<br />
工作模式2：Remote远程模式，使用HTTP分段请求提供服务<br />
工作模式3：Mapped映射模式，使用JSON编码请求从远程或本地文件提供服务<br />
支持自适应码率<br />
播放列表（Mapped映射模式）<br />
模拟直播（Mapped映射模式）<br />
文件未找到回溯（在多数据中心环境中有用）<br />
视频编码：H264，H265（DASH/HLS），VP9（DASH）<br />
音频编码：AAC，MP3<br />
WebVTT/SRT字幕支持：1、DASH，2、HLS，3、MSS<br />
支持Audio only/Video only文件<br />
备用音轨支持1：生成多个音轨的manifest文件，在用户端选择<br />
备用音轨支持2：单视频多音频文件多路复用，无需用户端支持<br />
多音视频轨道选择<br />
支持0.5-2倍变速（需要libavcodec和libavfilter）<br />
源文件剪裁（I-Frame到P-frame）<br />
支持可变分段长度-授权播放器选择最佳码率，防止过短分段<br />
Clipping of MP4 files for progressive download playback<br />
缩略图截取（需要libavcodec）<br />
解密CENC加密的MP4文件（it is possible to create such files with MP4Box)<br />
DASH: 通用加密（CENC）支持<br />
MSS: PlayReady encryption support<br />
HLS: Generation of I-frames playlist (EXT-X-I-FRAMES-ONLY)<br />
HLS: 支持AES-128 / SAMPLE-AES加密  </p>
<h3 id="_2">实际测试支持文件格式<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>mp4，mov<br />
支持编码的avi文件  </p>
<h3 id="_3">最佳视频参数<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><a href="https://knowledge.kaltura.com/recommended-video-source-formats-and-specifications">https://knowledge.kaltura.com/recommended-video-source-formats-and-specifications</a></p>
<h4 id="_4">建议的视频设置<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Recommended</th>
<th>Avoid</th>
</tr>
</thead>
<tbody>
<tr>
<td>Compressed Source</td>
<td>H.264, ProRes</td>
<td></td>
</tr>
<tr>
<td>Container</td>
<td>MOV, MP4</td>
<td></td>
</tr>
<tr>
<td>Bitrate</td>
<td>x1.5-2 of the largest flavor</td>
<td></td>
</tr>
<tr>
<td>Frame Size</td>
<td>As big as the largest desired flavor</td>
<td>Don’t scale/zoom</td>
</tr>
<tr>
<td>Frame Size</td>
<td>Multiples of 16 (see below)</td>
<td></td>
</tr>
<tr>
<td>Frame Size</td>
<td>Keep the original</td>
<td>Don’t re-sample</td>
</tr>
</tbody>
</table>
<h4 id="quicktime-mpeg-4">QuickTime MPEG-4 设置建议<a class="headerlink" href="#quicktime-mpeg-4" title="Permanent link">&para;</a></h4>
<p>MP4/MOV Streaming - choose Fast-Start.<br />
MP4 Video Compression - choose H.264 High profile.<br />
Bitrate – based on video dimensions. See table below. <br />
Progressive scan mode – avoid interlaced (Kaltura can handle interlaced as well, but it’s not recommended).<br />
Multi pass –multi-pass will provide better quality (although Kaltura can convert single-pass file as well). <br />
VBR vs. CBR - VBR (variable bitrate) usually provides better quality than CBR (constant bitrate).<br />
Frame Rate – choose Current.  </p>
<h4 id="_5">不同视频尺寸建议码率<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>理想的码率是6-8kbps<br />
带*号的是kaltrua的默认配置  </p>
<table>
<thead>
<tr>
<th>16:9</th>
<th>4:3</th>
<th>Bitrate Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>*1920x1080 (1080p)</td>
<td></td>
<td>6,000-8,000 Kbps</td>
</tr>
<tr>
<td>*1280x720 (720p)</td>
<td></td>
<td>3,750-5,000 Kbps</td>
</tr>
<tr>
<td>*1024x720 (iPad)</td>
<td></td>
<td>3,750-5,000 Kbps</td>
</tr>
<tr>
<td>960x540 (540p)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>720x405</td>
<td></td>
<td></td>
</tr>
<tr>
<td>640x360</td>
<td>640x480</td>
<td>1,350-1,800 Kbps</td>
</tr>
<tr>
<td>560x315</td>
<td>560x420</td>
<td></td>
</tr>
<tr>
<td>*480x270</td>
<td>480x360</td>
<td>600-800 Kbps</td>
</tr>
<tr>
<td>400x225</td>
<td>400x300</td>
<td></td>
</tr>
<tr>
<td>*320x180</td>
<td>320x240</td>
<td>600-800 Kbps</td>
</tr>
</tbody>
</table>
<h4 id="_6">建议的音频编码设置<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>File</th>
<th>Recommended</th>
<th>Avoid</th>
</tr>
</thead>
<tbody>
<tr>
<td>Compression</td>
<td>AAC, MP3</td>
<td>Nellymoser</td>
</tr>
<tr>
<td>Channels</td>
<td>Stereo, Mono</td>
<td>Surround, 7.1</td>
</tr>
<tr>
<td>Sample Size</td>
<td>44.1 kHz or lower</td>
<td></td>
</tr>
<tr>
<td>Sound Levels</td>
<td>Normalized</td>
<td>Peaks, low sound</td>
</tr>
</tbody>
</table>
<h3 id="best-practices-for-multi-device-transcoding">Best Practices For Multi-Device Transcoding<a class="headerlink" href="#best-practices-for-multi-device-transcoding" title="Permanent link">&para;</a></h3>
<p><a href="https://knowledge.kaltura.com/best-practices-multi-device-transcoding">https://knowledge.kaltura.com/best-practices-multi-device-transcoding</a></p>
<h3 id="ngx_http_hls">ngx_http_hls支持的文件格式与编码格式<a class="headerlink" href="#ngx_http_hls" title="Permanent link">&para;</a></h3>
<h4 id="_7">支持文件格式<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>The ngx_http_hls_module module provides HTTP Live Streaming (HLS) server-side support for MP4 and MOV media files. </p>
<h4 id="_8">通常后缀名<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<p>Such files typically have the .mp4, .m4v, .m4a, .mov, or .qt filename extensions. </p>
<h4 id="_9">支持编码格式<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>The module supports H.264 video codec, AAC and MP3 audio codecs.</p>
<h2 id="_10">限制<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>轨道选择和码率变化在progressive download下不支持<br />
I-frames playlist generation is not supported when encryption is enabled<br />
只在Linux下测试通过  </p>
<h2 id="_11">安装<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="_12">编译<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>cd到NGINX源代码目录执行</p>
<pre class="codehilite"><code class="language-sh">./configure --add-module=/path/to/nginx-vod-module
make
make install</code></pre>


<p>异步I/O支持加--with-file-aio（强烈建议，只支持local和mapped模式）</p>
<pre class="codehilite"><code class="language-sh">./configure --add-module=/path/to/nginx-vod-module --with-file-aio</code></pre>


<p>支持使用线程池异步打开文件（只支持nginx 1.7.11以上，local和mapped模式）</p>
<pre class="codehilite"><code class="language-sh">./configure -add-module=/path/to/nginx-vod-module --with-threads</code></pre>


<p>gcc编译优化-O3，和-O比较可以提升8%的MP4解析速度和帧处理之间</p>
<pre class="codehilite"><code class="language-sh">./configure --add-module=/path/to/nginx-vod-module --with-cc-opt=&quot;-O3&quot;</code></pre>


<p>打印debug消息</p>
<pre class="codehilite"><code class="language-sh">./configure --add-module=/path/to/nginx-vod-module --with-debug</code></pre>


<p>关闭编译优化（方便gdb调试）</p>
<pre class="codehilite"><code class="language-sh">./configure --add-module=/path/to/nginx-vod-module --with-cc-opt=&quot;-O0&quot;</code></pre>


<h3 id="rhelcentos-rpm">RHEL/CentOS RPM<a class="headerlink" href="#rhelcentos-rpm" title="Permanent link">&para;</a></h3>
<h4 id="rhel-or-centos-6">RHEL or CentOS 6<a class="headerlink" href="#rhel-or-centos-6" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">rpm -ihv http://installrepo.kaltura.org/releases/kaltura-release.noarch.rpm
yum install kaltura-nginx</code></pre>


<h4 id="rhel-or-centos-7">RHEL or CentOS 7<a class="headerlink" href="#rhel-or-centos-7" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">rpm -ihv http://installrepo.kaltura.org/releases/kaltura-release.noarch.rpm   </code></pre>


<p>修改/etc/yum.repos.d/kaltura.repo<br />
将</p>
<pre class="codehilite"><code>baseurl = http://installrepo.kaltura.org/releases/latest/RPMS/$basearch/</code></pre>


<p>替换为</p>
<pre class="codehilite"><code>baseurl = http://installrepo.kaltura.org/releases/rhel7/RPMS/$basearch/</code></pre>


<h3 id="debianubuntu-rpm">Debian/Ubuntu RPM<a class="headerlink" href="#debianubuntu-rpm" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-sh">wget -O - http://installrepo.kaltura.org/repo/apt/debian/kaltura-deb.gpg.key|apt-key add -
echo &quot;deb [arch=amd64] http://installrepo.kaltura.org/repo/apt/debian kajam main&quot; &gt; /etc/apt/sources.list.d/kaltura.list
apt-get update
apt-get install kaltura-nginx</code></pre>


<h4 id="_13">注意<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>Ubuntu NOTE: You must also make sure the multiverse repo is enabled in /etc/apt/sources.list</p>
<h2 id="url">URL结构<a class="headerlink" href="#url" title="Permanent link">&para;</a></h2>
<h3 id="url_1">基本URL结构<a class="headerlink" href="#url_1" title="Permanent link">&para;</a></h3>
<h4 id="_14">结构<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code>http://&lt;domain&gt;/&lt;location&gt;/&lt;fileuri&gt;/&lt;filename&gt;  </code></pre>


<h4 id="fileuri">fileuri<a class="headerlink" href="#fileuri" title="Permanent link">&para;</a></h4>
<p>local模式：根目录root /的相对路径<br />
mapped模式：根据从upstream /收到的JSON确定<br />
remote模式：读取chunks的mp4文件路径  </p>
<h3 id="url_2">多文件合一URL结构<a class="headerlink" href="#url_2" title="Permanent link">&para;</a></h3>
<h4 id="_15">多合一<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code>http://&lt;domain&gt;/&lt;location&gt;/&lt;prefix&gt;,&lt;middle1&gt;,&lt;middle2&gt;,&lt;middle3&gt;,&lt;postfix&gt;.urlset/&lt;filename&gt;  </code></pre>


<h4 id="_16">分解<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code>http://&lt;domain&gt;/&lt;location&gt;&lt;prefix&gt;&lt;middle1&gt;&lt;postfix&gt;/&lt;filename&gt;  
http://&lt;domain&gt;/&lt;location&gt;&lt;prefix&gt;&lt;middle2&gt;&lt;postfix&gt;/&lt;filename&gt;  
http://&lt;domain&gt;/&lt;location&gt;&lt;prefix&gt;&lt;middle3&gt;&lt;postfix&gt;/&lt;filename&gt;  </code></pre>


<h4 id="_17">注意<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>The suffix .urlset (can be changed with vod_multi_uri_suffix) indicates that the URL should be treated as a multi URL.  </p>
<h3 id="url_3">URL路径参数<a class="headerlink" href="#url_3" title="Permanent link">&para;</a></h3>
<p>clipFrom：播放开始时间毫秒 例如 .../clipFrom/10000/...<br />
clipTo: 播放结束时间毫秒 例如 .../clipTo/60000/...<br />
tracks: 音视频轨道 例如 .../tracks/v1-a1/...  </p>
<h3 id="_18">文件名结构<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<h4 id="_19">结构<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code>&lt;basename&gt;[&lt;seqparams&gt;][&lt;fileparams&gt;][&lt;trackparams&gt;][&lt;langparams&gt;].&lt;extension&gt;  </code></pre>


<h4 id="basename">basename<a class="headerlink" href="#basename" title="Permanent link">&para;</a></h4>
<p>dash - manifest.mpd<br />
hds - manifest.f4m<br />
hls master playlist - master.m3u8<br />
hls media playlist - index.m3u8<br />
mss - manifest<br />
thumb - thumb-<offset>.jpg (offset is the thumbnail video offset in milliseconds)  </p>
<h4 id="seqparams-sseq">seqparams （sseq）<a class="headerlink" href="#seqparams-sseq" title="Permanent link">&para;</a></h4>
<p>序号，如 master-sseq1.m3u8</p>
<h4 id="fileparams-f">fileparams （f）<a class="headerlink" href="#fileparams-f" title="Permanent link">&para;</a></h4>
<p>多路复用参数，如manifest-f1.mpd </p>
<h4 id="trackparams-t">trackparams （t）<a class="headerlink" href="#trackparams-t" title="Permanent link">&para;</a></h4>
<p>轨道参数，如manifest-a1.f4m <br />
默认使用每个文件的第一个音轨和第一个视轨 <br />
与URL中/tracks/参数进行AND操作  </p>
<h4 id="langparams">langparams<a class="headerlink" href="#langparams" title="Permanent link">&para;</a></h4>
<p>语言音轨，如master-leng.m3u8</p>
<h2 id="mappingjson">Mapping模式JSON响应格式<a class="headerlink" href="#mappingjson" title="Permanent link">&para;</a></h2>
<p>Mapping模式时，nginx-vod-module向配置的upstream上游服务器发出http请求，接收它应该生成的多媒体。<br />
upstream上游服务器必须响应JSON格式。  </p>
<h3 id="_20">示例字段说明准备<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>1、Source Clip 从单一媒体文件中提取的音视频轨道。<br />
2、Filter 对音视频轨道的筛选、操作。速率变化/音量大小/min多个音轨混合。<br />
3、Clip 经过一系列Source Clip和Filter操作之后得到的结果。<br />
4、Sequence 一些列应该被顺序播放的Clip。<br />
5、Set 几个分辨率不同自适应播放的Sequence，每个Sequence内的Clip必须相同。  </p>
<h3 id="_21">示例：简单映射<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>请求单一MP4文件</p>
<pre class="codehilite"><code class="language-json">{
    &quot;sequences&quot;:[
        {
            &quot;clips&quot;:[
                {
                    &quot;type&quot;:&quot;source&quot;,
                    &quot;path&quot;:&quot;/path/to/video.mp4&quot;
                }
            ]
        }
    ]
}</code></pre>


<h3 id="_22">示例：自适应集合<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-json">{
    &quot;sequences&quot;:[
        {
            &quot;clips&quot;:[
                &quot;type&quot;:&quot;source&quot;,
                &quot;path&quot;:&quot;/path/to/bitrate1.mp4&quot;
            ]
        },
        {
            &quot;clips&quot;:[
                &quot;type&quot;:&quot;source&quot;,
                &quot;path&quot;:&quot;/path/to/bitrate2.mp4&quot;
            ]
        }
    ]
}</code></pre>


<h3 id="_23">示例：播放列表<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>一个35秒的视频加一个22秒的视频</p>
<pre class="codehilite"><code class="language-json">{
    &quot;durations&quot;:[35000, 22000],
    &quot;sequences&quot;:[
        {
            &quot;clips&quot;:[
                &quot;type&quot;:&quot;source&quot;,
                &quot;path&quot;:&quot;/path/to/video1.mp4&quot;
            ]
        },
        {
            &quot;clips&quot;:[
                &quot;type&quot;:&quot;source&quot;,
                &quot;path&quot;:&quot;/path/to/video2.mp4&quot;
            ]
        }
    ]
}</code></pre>


<h3 id="_24">示例：过滤器<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>以1.5被速率播放视频1，混合使用50%音量的视频2的音轨</p>
<pre class="codehilite"><code class="language-json">{
    &quot;sequences&quot;: [
        {
            &quot;clips&quot;: [
                {
                    &quot;type&quot;: &quot;mixFilter&quot;,
                    &quot;sources&quot;: [
                        {
                            &quot;type&quot;: &quot;rateFilter&quot;,
                            &quot;rate&quot;: 1.5,
                            &quot;source&quot;: {
                                &quot;type&quot;: &quot;source&quot;,
                                &quot;path&quot;: &quot;/path/to/video1.mp4&quot;
                            }
                        },
                        {
                            &quot;type&quot;: &quot;gainFilter&quot;,
                            &quot;gain&quot;: 0.5,
                            &quot;source&quot;: {
                                &quot;type&quot;: &quot;source&quot;,
                                &quot;path&quot;: &quot;/path/to/video2.mp4&quot;,
                                &quot;tracks&quot;: &quot;a1&quot;
                            }
                        }
                    ]
                }
            ]
        }
    ]
}</code></pre>


<h3 id="_25">示例：连续直播<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-json">{
    &quot;playlistType&quot;: &quot;live&quot;,
    &quot;discontinuity&quot;: false,
    &quot;segmentBaseTime&quot;: 1451904060000,
    &quot;firstClipTime&quot;: 1451917506000,
    &quot;durations&quot;: [83000, 83000],
    &quot;sequences&quot;: [
        {
            &quot;clips&quot;: [
                {
                    &quot;type&quot;: &quot;source&quot;,
                    &quot;path&quot;: &quot;/path/to/video1.mp4&quot;
                },
                {
                    &quot;type&quot;: &quot;source&quot;,
                    &quot;path&quot;: &quot;/path/to/video2.mp4&quot;
                }
            ]
        }
    ]
}</code></pre>


<h3 id="_26">示例：不连续直播<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-json">{
    &quot;playlistType&quot;: &quot;live&quot;,
    &quot;discontinuity&quot;: true,
    &quot;initialClipIndex&quot;: 171,
    &quot;initialSegmentIndex&quot;: 153,
    &quot;firstClipTime&quot;: 1451918170000,
    &quot;durations&quot;: [83000, 83000],
    &quot;sequences&quot;: [
        {
            &quot;clips&quot;: [
                {
                    &quot;type&quot;: &quot;source&quot;,
                    &quot;path&quot;: &quot;/path/to/video1.mp4&quot;
                },
                {
                    &quot;type&quot;: &quot;source&quot;,
                    &quot;path&quot;: &quot;/path/to/video2.mp4&quot;
                }
            ]
        }
    ]
}</code></pre>


<h3 id="mapping">Mapping模式参数说明<a class="headerlink" href="#mapping" title="Permanent link">&para;</a></h3>
<h4 id="set">Set<a class="headerlink" href="#set" title="Permanent link">&para;</a></h4>
<h4 id="sequence">Sequence<a class="headerlink" href="#sequence" title="Permanent link">&para;</a></h4>
<h4 id="clipabstract">Clip（abstract）<a class="headerlink" href="#clipabstract" title="Permanent link">&para;</a></h4>
<h4 id="source-clip">Source clip<a class="headerlink" href="#source-clip" title="Permanent link">&para;</a></h4>
<h4 id="rate-filter-clip">Rate filter clip<a class="headerlink" href="#rate-filter-clip" title="Permanent link">&para;</a></h4>
<h4 id="gain-filter-clip">Gain filter clip<a class="headerlink" href="#gain-filter-clip" title="Permanent link">&para;</a></h4>
<h4 id="mix-filter-clip">Mix filter clip<a class="headerlink" href="#mix-filter-clip" title="Permanent link">&para;</a></h4>
<h4 id="concat-clip">Concat clip<a class="headerlink" href="#concat-clip" title="Permanent link">&para;</a></h4>
<h4 id="dynamic-clip">Dynamic clip<a class="headerlink" href="#dynamic-clip" title="Permanent link">&para;</a></h4>
<h4 id="notification">Notification<a class="headerlink" href="#notification" title="Permanent link">&para;</a></h4>
<h2 id="_27">安全<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h2>
<h3 id="_28">鉴权<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<h4 id="cdn">CDN分发<a class="headerlink" href="#cdn" title="Permanent link">&para;</a></h4>
<h4 id="_29">直接分发<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h4>
<h3 id="url_4">URL加密<a class="headerlink" href="#url_4" title="Permanent link">&para;</a></h3>
<h3 id="_30">多媒体加密<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<h3 id="drm">DRM<a class="headerlink" href="#drm" title="Permanent link">&para;</a></h3>
<h2 id="_31">性能建议<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h2>
<ol>
<li>中型大型部署，不要让用户直接从nginx-vod-module播放，应该使用HTTP代理或CDN。<br />
     中型部署添加一个缓存代理，使用nginx server的proxy_pass和proxy_cache。<br />
     通常nginx-vod-module与mp4文件越近越好，缓存代理离用户越近越好。  </li>
<li>开启nginx-vod-module缓存<br />
      vod_metadata_cache，为每个分段保存需要重复读取的video metadata，缓存大小应该是GB级别。<br />
      vod_response_cache，保存manifest清单请求，如果有中间代理层，这个缓存不是必须的，没有必要设置很大，128M一般够用。<br />
      vod_mapping_cache，mapped模式，几MB即可。<br />
      nginx's open_file_cache，缓存打开的文件句柄。<br />
      打开vod_performance_counters可以跟踪命中率，启用一个nginx vod状态页面。  </li>
<li>在local和mapped模式下，打开aio异步I/O，必须在编译时和配置时打开aio选项，可以通过状态页面的read_file(aio off)值对比async_read_file(aio on)。  </li>
<li>在local和mapped模式下，打开异步文件打开，必须在编译时和配置时打开vod_open_file_thread_pool选项，可以通过状态页面的open_file值对比async_open_file值。  </li>
<li></li>
<li></li>
<li>为manifest文件打开gzip压缩<br />
     gzip_types application/vnd.apple.mpegurl video/f4m application/dash+xml text/xml  </li>
<li></li>
</ol>
<h2 id="_32">配置<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h2>
<h3 id="_33">配置示例<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<h4 id="local">Local模式<a class="headerlink" href="#local" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx.conf">http {
    upstream fallback {
        server fallback.kaltura.com:80;
    }

    server {
        # vod settings
        vod_mode local;                                                                # 模式设置
        vod_fallback_upstream_location /fallback;                       # 请求转发
        vod_last_modified 'Sun, 19 Nov 2000 08:52:00 GMT';      # 为直播修改最后修改时间参数
        vod_last_modified_types *;

        # vod caches
        vod_metadata_cache metadata_cache 512m;                  # 视频元数据缓存
        vod_response_cache response_cache 128m;                    # manifest index缓存

        # gzip manifests
        gzip on;                                                                             # manifest index 打开gzip压缩
        gzip_types application/vnd.apple.mpegurl;                      # 要压缩的文件类型

        # file handle caching / aio
        open_file_cache          max=1000 inactive=5m;                # nginx文件句柄缓存
        open_file_cache_valid    2m;
        open_file_cache_min_uses 1;
        open_file_cache_errors   on;
        aio on;                                                                               # 打开异步I/O

        location ^~ /fallback/ {
            internal;
            proxy_pass http://fallback/;
            proxy_set_header Host $http_host;
        }

        location /content/ {
            root /web/;
            vod hls;

            add_header Access-Control-Allow-Headers '*';
            add_header Access-Control-Expose-Headers 'Server,range,Content-Length,Content-Range';
            add_header Access-Control-Allow-Methods 'GET, HEAD, OPTIONS';
            add_header Access-Control-Allow-Origin '*';
            expires 100d;
        }
    }
}</code></pre>


<h4 id="mapped">Mapped模式<a class="headerlink" href="#mapped" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx.conf">http {
    upstream kalapi {
        server www.kaltura.com:80;
    }

    upstream fallback {
        server fallback.kaltura.com:80;
    }

    server {
        # vod settings
        vod_mode mapped;
        vod_upstream_location /kalapi;
        vod_upstream_extra_args &quot;pathOnly=1&quot;;
        vod_fallback_upstream_location /fallback;
        vod_last_modified 'Sun, 19 Nov 2000 08:52:00 GMT';
        vod_last_modified_types *;

        # vod caches
        vod_metadata_cache metadata_cache 512m;
        vod_response_cache response_cache 128m;
        vod_mapping_cache mapping_cache 5m;

        # gzip manifests
        gzip on;
        gzip_types application/vnd.apple.mpegurl;

        # file handle caching / aio
        open_file_cache          max=1000 inactive=5m;
        open_file_cache_valid    2m;
        open_file_cache_min_uses 1;
        open_file_cache_errors   on;
        aio on;

        location ^~ /fallback/ {
            internal;
            proxy_pass http://fallback/;
            proxy_set_header Host $http_host;
        }

        location ^~ /kalapi/ {
            internal;
            proxy_pass http://kalapi/;
            proxy_set_header Host $http_host;
        }

        location ~ ^/p/\d+/(sp/\d+/)?serveFlavor/ {
            # encrypted hls
            vod hls;
            vod_secret_key &quot;mukkaukk$vod_filepath&quot;;
            vod_hls_encryption_method aes-128;

            add_header Access-Control-Allow-Headers '*';
            add_header Access-Control-Expose-Headers 'Server,range,Content-Length,Content-Range';
            add_header Access-Control-Allow-Methods 'GET, HEAD, OPTIONS';
            add_header Access-Control-Allow-Origin '*';
            expires 100d;
        }
    }
}</code></pre>


<h4 id="remote">Remote模式<a class="headerlink" href="#remote" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx.conf">http {
    upstream kalapi {
        server www.kaltura.com:80;
    }

    server {
        # vod settings
        vod_mode remote;
        vod_upstream_location /kalapi;
        vod_last_modified 'Sun, 19 Nov 2000 08:52:00 GMT';
        vod_last_modified_types *;

        # vod caches
        vod_metadata_cache metadata_cache 512m;
        vod_response_cache response_cache 128m;

        # gzip manifests
        gzip on;
        gzip_types application/vnd.apple.mpegurl;

        location ^~ /kalapi/ {
            internal;
            proxy_pass http://kalapi/;
            proxy_set_header Host $http_host;
        }

        location ~ ^/p/\d+/(sp/\d+/)?serveFlavor/ {
            vod hls;

            add_header Access-Control-Allow-Headers '*';
            add_header Access-Control-Expose-Headers 'Server,range,Content-Length,Content-Range';
            add_header Access-Control-Allow-Methods 'GET, HEAD, OPTIONS';
            add_header Access-Control-Allow-Origin '*';
            expires 100d;
        }
    }
}</code></pre>


<h3 id="nginx">Nginx变量<a class="headerlink" href="#nginx" title="Permanent link">&para;</a></h3>
<p>NGINX模块变量<br />
$vod_suburi - the current sub uri. For example, if the url is: http://<domain>/<location>/<prefix>,<middle1>,<middle2>,<middle3>,<postfix>.urlset/<filename> $vod_suburi will have the value http://<domain>/<location>/<prefix><middle1><postfix>/<filename> when processing the first uri.<br />
$vod_filepath - in local / mapped modes, the file path of current sub uri. In remote mode, has the same value as $vod_suburi.<br />
$vod_sequence_id - contains the id of the current sequence, if no id was specified in the mapping json this variable will be the same as $vod_suburi.<br />
$vod_clip_id - the id of the current clip, this variable has a value during these phases:<br />
Mapping of dynamic clips to concat clips<br />
Mapping of source clip to paths<br />
$vod_notification_id - the id of the current notification, the value is non-empty only when referenced by vod_notification_uri<br />
$vod_dynamic_mapping - a serialized representation of the mapping of dynamic clips to concat clips.<br />
$vod_request_params - a serialized representation of the request params, e.g. 12-f2-v1-a1. The variable contains:<br />
The segment index (for a segment request)<br />
The sequence index<br />
A selection of audio/video tracks<br />
Note: Configuration directives that can accept variables are explicitly marked as such.  </p>
<h3 id="_34">配置指令：基础<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<h4 id="vod">vod 分段模式<a class="headerlink" href="#vod" title="Permanent link">&para;</a></h4>
<p>语法：vod segmenter<br />
默认：n/a<br />
上下文：location  </p>
<p>segmenter：<br />
1、none MP4文件<br />
2、dash Dynamic Adaptive Streaming over HTTP分包<br />
3、hds Adobe HTTP Dynamic Streaming分包<br />
4、hls Apple HTTP Live Streaming分包<br />
5、mss 微软Smooth Streaming分包<br />
6、thumb 缩略图  </p>
<h4 id="vod_mode">vod_mode 模式<a class="headerlink" href="#vod_mode" title="Permanent link">&para;</a></h4>
<p>语法：vod_mode mode<br />
默认：local<br />
上下文：http, server, location  </p>
<h4 id="vod_status">vod_status 开启监控<a class="headerlink" href="#vod_status" title="Permanent link">&para;</a></h4>
<p>语法：vod_status status<br />
默认：n/a<br />
上下文：location  </p>
<h3 id="segmentation">配置指令：segmentation分段<a class="headerlink" href="#segmentation" title="Permanent link">&para;</a></h3>
<h4 id="vod_segment_duration">vod_segment_duration 分段时长<a class="headerlink" href="#vod_segment_duration" title="Permanent link">&para;</a></h4>
<p>语法：vod_segment_duration duration<br />
默认：10s<br />
上下文：http, server, location  </p>
<p>强烈建议设置为GOP的倍数，如果不是GOP的倍数且vod_align_segments_to_key_frames开启，manifest中的分段时间和实际会有明显差别，还会带来空分段。  </p>
<h4 id="vod_live_window_duration">vod_live_window_duration 直播窗口时长<a class="headerlink" href="#vod_live_window_duration" title="Permanent link">&para;</a></h4>
<p>语法：vod_live_window_duration duration<br />
默认：30000<br />
上下文：http, server, location  </p>
<p>？  </p>
<h4 id="vod_bootstrap_segment_durations">vod_bootstrap_segment_durations 启动分段时长<a class="headerlink" href="#vod_bootstrap_segment_durations" title="Permanent link">&para;</a></h4>
<p>语法：vod_bootstrap_segment_durations duration<br />
默认：none<br />
上下文：http, server, location  </p>
<p>启动时分段时长，设置较短启动分段用于尽早确定码率，避免全程分段短。  </p>
<h4 id="vod_align_segments_to_key_frames">vod_align_segments_to_key_frames 分段由关键帧开始<a class="headerlink" href="#vod_align_segments_to_key_frames" title="Permanent link">&para;</a></h4>
<p>语法：vod_align_segments_to_key_frames on/off<br />
默认：off<br />
上下文：http, server, location  </p>
<p>开启后分段由关键帧开始，可能会导致实际分段时长与manifest中声明的时长不同，除非vod_manifest_segment_durations_mode设置为accurate。  </p>
<h4 id="vod_segment_count_policy">vod_segment_count_policy 分段计数策略<a class="headerlink" href="#vod_segment_count_policy" title="Permanent link">&para;</a></h4>
<p>语法：vod_segment_count_policy last_short/last_long/last_rounded<br />
默认：last_short<br />
上下文：http, server, location  </p>
<p>假设分段设置为10秒:<br />
last_short：一个33秒的视频会分段为10, 10, 10, 3<br />
last_long：一个33秒的视频会分段为10, 10, 13<br />
last_rounded：一个33秒的视频会分段为10, 10, 13，一个38秒的视频会分段为10, 10, 10, 8 </p>
<h4 id="vod_manifest_segment_durations_mode-manifest">vod_manifest_segment_durations_mode manifest文件分段时长准确度模式<a class="headerlink" href="#vod_manifest_segment_durations_mode-manifest" title="Permanent link">&para;</a></h4>
<p>语法：vod_manifest_segment_durations_mode estimate/accurate<br />
默认：estimate<br />
上下文：http, server, location  </p>
<p>设置分段精确度模式：<br />
estimate：估算模式，设置为10秒则manifest中显示为#EXTINF:10<br />
accurate：精确模式， 假设帧率为29.97分段为10秒，则分段为10.01秒。如果vod_align_segment_to_key_frames设置为on，则关键帧也会被计算。  </p>
<h3 id="upstream">配置指令：upstream<a class="headerlink" href="#upstream" title="Permanent link">&para;</a></h3>
<p>上游服务器配置</p>
<h3 id="fallback">配置指令：fallback<a class="headerlink" href="#fallback" title="Permanent link">&para;</a></h3>
<p>失败回溯配置</p>
<h3 id="_35">配置指令：性能<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<h4 id="vod_metadata_cache">vod_metadata_cache 视频分段缓存<a class="headerlink" href="#vod_metadata_cache" title="Permanent link">&para;</a></h4>
<p>语法：vod_metadata_cache zone_name zone_size [expiration]<br />
默认：off<br />
上下文：http, server, location<br />
设置视频分段缓存大小和过期时间。  </p>
<h4 id="vod_mapping_cache">vod_mapping_cache<a class="headerlink" href="#vod_mapping_cache" title="Permanent link">&para;</a></h4>
<p>语法：vod_mapping_cache zone_name zone_size [expiration]<br />
默认：off<br />
上下文：http, server, location<br />
Configures the size and shared memory object name of the mapping cache for vod (mapped mode only).  </p>
<h4 id="vod_live_mapping_cache">vod_live_mapping_cache<a class="headerlink" href="#vod_live_mapping_cache" title="Permanent link">&para;</a></h4>
<p>语法：vod_live_mapping_cache zone_name zone_size [expiration]<br />
默认：off<br />
上下文：http, server, location<br />
Configures the size and shared memory object name of the mapping cache for live (mapped mode only).  </p>
<h4 id="vod_response_cache">vod_response_cache<a class="headerlink" href="#vod_response_cache" title="Permanent link">&para;</a></h4>
<p>语法：vod_response_cache zone_name zone_size [expiration]<br />
默认：off<br />
上下文：http, server, location<br />
设置视频manifests文件和非视频文件缓存。  </p>
<h4 id="vod_live_response_cache">vod_live_response_cache<a class="headerlink" href="#vod_live_response_cache" title="Permanent link">&para;</a></h4>
<p>语法：vod_live_response_cache zone_name zone_size [expiration]<br />
默认：off<br />
上下文：http, server, location<br />
Configures the size and shared memory object name of the response cache for time changing live responses. This cache holds the following types of responses for live: DASH MPD, HLS index M3U8, HDS bootstrap, MSS manifest.  </p>
<h4 id="vod_initial_read_size">vod_initial_read_size 初始读取大小<a class="headerlink" href="#vod_initial_read_size" title="Permanent link">&para;</a></h4>
<p>语法：vod_initial_read_size size<br />
默认：4K<br />
上下文：http, server, location <br />
设置MP4文件初始读取大小  </p>
<h4 id="vod_max_metadata_size">vod_max_metadata_size 最大支持视频元数据大小<a class="headerlink" href="#vod_max_metadata_size" title="Permanent link">&para;</a></h4>
<p>语法：vod_max_metadata_size  size<br />
默认：128MB <br />
上下文：http, server, location<br />
设置最大支持的视频元数据大小 (即MP4 - moov 元素大小)  </p>
<h4 id="vod_max_frames_size">vod_max_frames_size 最大帧大小<a class="headerlink" href="#vod_max_frames_size" title="Permanent link">&para;</a></h4>
<p>语法：vod_max_frames_size size<br />
默认：16MB<br />
上下文：http, server, location<br />
Sets the limit on the total size of the frames of a single segment  </p>
<h4 id="vod_cache_buffer_size">vod_cache_buffer_size<a class="headerlink" href="#vod_cache_buffer_size" title="Permanent link">&para;</a></h4>
<p>语法：vod_cache_buffer_size size<br />
默认：256K<br />
上下文：http, server, location<br />
Sets the size of the cache buffers used when reading MP4 frames.  </p>
<h4 id="vod_open_file_thread_pool">vod_open_file_thread_pool<a class="headerlink" href="#vod_open_file_thread_pool" title="Permanent link">&para;</a></h4>
<p>语法：vod_open_file_thread_pool pool_name<br />
默认：off<br />
上下文：http, server, location<br />
Enables the use of asynchronous file open via thread pool. The thread pool must be defined with a thread_pool directive, if no pool name is specified the default pool is used. This directive is supported only on nginx 1.7.11 or newer when compiling with --add-threads. Note: this directive currently disables the use of nginx's open_file_cache by nginx-vod-module  </p>
<h4 id="vod_output_buffer_pool-http">vod_output_buffer_pool HTTP响应内存池<a class="headerlink" href="#vod_output_buffer_pool-http" title="Permanent link">&para;</a></h4>
<p>语法：vod_output_buffer_pool size count<br />
默认：off<br />
上下文：http, server, location <br />
Pre-allocates buffers for generating response data, saving the need allocate/free the buffers on every request.  </p>
<h4 id="vod_performance_counters">vod_performance_counters<a class="headerlink" href="#vod_performance_counters" title="Permanent link">&para;</a></h4>
<p>语法：vod_performance_counters zone_name<br />
默认：off<br />
上下文：http, server, location<br />
Configures the shared memory object name of the performance counters  </p>
<h3 id="url_5">配置指令：url结构<a class="headerlink" href="#url_5" title="Permanent link">&para;</a></h3>
<p>修改url结构</p>
<h3 id="_36">配置指令：响应头部<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h3>
<p>修改响应头部</p>
<h3 id="ad-stitching-mapped-mode-only">配置指令：ad stitching (mapped mode only)<a class="headerlink" href="#ad-stitching-mapped-mode-only" title="Permanent link">&para;</a></h3>
<h3 id="drm-encryption">配置指令：DRM / encryption<a class="headerlink" href="#drm-encryption" title="Permanent link">&para;</a></h3>
<h3 id="dash">配置指令：DASH<a class="headerlink" href="#dash" title="Permanent link">&para;</a></h3>
<h3 id="hds">配置指令：HDS<a class="headerlink" href="#hds" title="Permanent link">&para;</a></h3>
<h3 id="hls">配置指令：HLS<a class="headerlink" href="#hls" title="Permanent link">&para;</a></h3>
<h4 id="vod_hls_encryption_method">vod_hls_encryption_method<a class="headerlink" href="#vod_hls_encryption_method" title="Permanent link">&para;</a></h4>
<p>语法：vod_hls_encryption_method method<br />
默认：none<br />
上下文：http, server, location<br />
Sets the encryption method of HLS segments, allowed values are: none (default), aes-128, sample-aes.  </p>
<h4 id="vod_hls_absolute_master_urls-manifesturl">vod_hls_absolute_master_urls 设置manifest文件url相对/绝对<a class="headerlink" href="#vod_hls_absolute_master_urls-manifesturl" title="Permanent link">&para;</a></h4>
<p>语法：vod_hls_absolute_master_urls on/off<br />
默认：on<br />
上下文：http, server, location<br />
When enabled the server returns absolute playlist URLs in master playlist requests  </p>
<h4 id="vod_hls_absolute_index_urls-manifesturl">vod_hls_absolute_index_urls 设置manifest文件url相对/绝对<a class="headerlink" href="#vod_hls_absolute_index_urls-manifesturl" title="Permanent link">&para;</a></h4>
<p>语法：vod_hls_absolute_index_urls on/off<br />
默认：on<br />
上下文：http, server, location<br />
When enabled the server returns absolute segment URLs in media playlist requests  </p>
<h4 id="vod_hls_absolute_iframe_urls">vod_hls_absolute_iframe_urls<a class="headerlink" href="#vod_hls_absolute_iframe_urls" title="Permanent link">&para;</a></h4>
<p>语法：vod_hls_absolute_iframe_urls on/off<br />
默认：off<br />
上下文：http, server, location<br />
When enabled the server returns absolute segment URLs in iframe playlist requests  </p>
<h4 id="vod_hls_master_file_name_prefix">vod_hls_master_file_name_prefix<a class="headerlink" href="#vod_hls_master_file_name_prefix" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_master_file_name_prefix name<br />
default: master<br />
context: http, server, location<br />
The name of the HLS master playlist file (an m3u8 extension is implied).  </p>
<h4 id="vod_hls_index_file_name_prefix">vod_hls_index_file_name_prefix<a class="headerlink" href="#vod_hls_index_file_name_prefix" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_index_file_name_prefix name<br />
default: index<br />
context: http, server, location<br />
The name of the HLS media playlist file (an m3u8 extension is implied).  </p>
<h4 id="vod_hls_iframes_file_name_prefix">vod_hls_iframes_file_name_prefix<a class="headerlink" href="#vod_hls_iframes_file_name_prefix" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_iframes_file_name_prefix name<br />
default: iframes<br />
context: http, server, location<br />
The name of the HLS I-frames playlist file (an m3u8 extension is implied).  </p>
<h4 id="vod_hls_segment_file_name_prefix">vod_hls_segment_file_name_prefix<a class="headerlink" href="#vod_hls_segment_file_name_prefix" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_segment_file_name_prefix name<br />
default: seg<br />
context: http, server, location<br />
The prefix of segment file names, the actual file name is seg-<index>-v<video-track-index>-a<audio-track-index>.ts.  </p>
<h4 id="vod_hls_encryption_key_file_name">vod_hls_encryption_key_file_name<a class="headerlink" href="#vod_hls_encryption_key_file_name" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_encryption_key_file_name name<br />
default: encryption.key<br />
context: http, server, location<br />
The name of the encryption key file name, only relevant when encryption method is not none.  </p>
<h4 id="vod_hls_encryption_key_uri">vod_hls_encryption_key_uri<a class="headerlink" href="#vod_hls_encryption_key_uri" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_encryption_key_uri uri<br />
default: a url pointing to encryption.key<br />
context: http, server, location<br />
Sets the value of the URI attribute of EXT-X-KEY, only relevant when encryption method is not none. The parameter value can contain variables.  </p>
<h4 id="vod_hls_encryption_key_format">vod_hls_encryption_key_format<a class="headerlink" href="#vod_hls_encryption_key_format" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_encryption_key_format format<br />
default: none<br />
context: http, server, location<br />
Sets the value of the KEYFORMAT attribute of EXT-X-KEY, only relevant when encryption method is not none.  </p>
<h4 id="vod_hls_encryption_key_format_versions">vod_hls_encryption_key_format_versions<a class="headerlink" href="#vod_hls_encryption_key_format_versions" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_encryption_key_format_versions versions<br />
default: none<br />
context: http, server, location<br />
Sets the value of the KEYFORMATVERSIONS attribute of EXT-X-KEY, only relevant when encryption method is not none.  </p>
<h4 id="vod_hls_interleave_frames">vod_hls_interleave_frames 音视频交叉分包<a class="headerlink" href="#vod_hls_interleave_frames" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_interleave_frames on/off<br />
default: off<br />
context: http, server, location<br />
When enabled, the HLS muxer interleaves frames of different streams (audio / video). When disabled, on every switch between audio / video the muxer flushes the MPEG TS packet.  </p>
<h4 id="vod_hls_align_frames">vod_hls_align_frames 音视频帧对齐<a class="headerlink" href="#vod_hls_align_frames" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_align_frames on/off<br />
default: on<br />
context: http, server, location<br />
When enabled, every video / audio frame is aligned to MPEG TS packet boundary, padding is added as needed.  </p>
<h4 id="vod_hls_output_id3_timestamps">vod_hls_output_id3_timestamps<a class="headerlink" href="#vod_hls_output_id3_timestamps" title="Permanent link">&para;</a></h4>
<p>syntax: vod_hls_output_id3_timestamps on/off<br />
default: on<br />
context: http, server, location<br />
When enabled, an ID3 TEXT frame will be outputted in each TS segment, containing a JSON with the absolute segment timestamp. The timestamp is measured in milliseconds since the epoch (unixtime x 1000), the JSON structure is: {"timestamp":1459779115000}  </p>
<h3 id="mss">配置指令：MSS<a class="headerlink" href="#mss" title="Permanent link">&para;</a></h3>
<p>略</p>
<h3 id="_37">配置指令：缩略图截取<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<p>略</p>
<h3 id="misc">配置指令：misc 混合<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h3>
<p>略</p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../nginx/" title="Ningx" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Ningx
              </span>
            </div>
          </a>
        
        
          <a href="../ffmpeg/" title="FFmpeg" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                FFmpeg
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Yingxuanxuan.com
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/yingxuanxuan" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/yingxuanxuan_g" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-f7ac33b6fb.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-92401539-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>