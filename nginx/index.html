
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Linux学习笔记，Python学习笔记，Android学习笔记，前端学习笔记，nginx， nginx-vod-module，ffmpeg，pyqt，qt，Javascript，vue等">
      
      
        <link rel="canonical" href="https://yingxuanxuan.com/nginx/">
      
      
        <meta name="author" content="英旋 yingxuanxuan">
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.0.5">
    
    
      
        <title>Ningx - 学习笔记</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-9c62e3c932.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02ce7adcc2.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="blue" data-md-color-accent="lime">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="学习笔记" class=" md-logo  md-header-nav__button">
          
            <img src="../images/64X64.ico" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Linux
                </span>
              
            
            Ningx
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
              


  


  <a href="https://github.com/yingxuanxuan/yingxuanxuan.github.io" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../images/64X64.ico">
      
    </i>
    学习笔记
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/yingxuanxuan/yingxuanxuan.github.io" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href=".." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../linux/" title="Linux" class="md-nav__link">
        Linux
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Ningx" class="md-nav__link md-nav__link--active">
      Ningx
    </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../nginx-vod-module/" title="Nginx-vod-module" class="md-nav__link">
        Nginx-vod-module
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../ffmpeg/" title="FFmpeg" class="md-nav__link">
        FFmpeg
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../python/" title="Python" class="md-nav__link">
        Python
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../pyqt/" title="PyQt/Qt" class="md-nav__link">
        PyQt/Qt
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Android
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../android/" title="Android" class="md-nav__link">
        Android
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Javascript
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Javascript
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../javascript/" title="Javascript" class="md-nav__link">
        Javascript
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../vue/" title="Vue" class="md-nav__link">
        Vue
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="文档" class="md-nav__link">
    文档
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="安装" class="md-nav__link">
    安装
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repo" title="repo 安装" class="md-nav__link">
    repo 安装
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repo_1" title="repo" class="md-nav__link">
    repo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repo_2" title="导入repo签名" class="md-nav__link">
    导入repo签名
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="编译安装" class="md-nav__link">
    编译安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="操作命令" class="md-nav__link">
    操作命令
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" title="信号" class="md-nav__link">
    信号
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="命令" class="md-nav__link">
    命令
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="测试配置" class="md-nav__link">
    测试配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="查看编译选项" class="md-nav__link">
    查看编译选项
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="使用新配置" class="md-nav__link">
    使用新配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="动态改变配置" class="md-nav__link">
    动态改变配置
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="服务" class="md-nav__link">
    服务
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" title="配置" class="md-nav__link">
    配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" title="配置概述" class="md-nav__link">
    配置概述
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" title="注释" class="md-nav__link">
    注释
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" title="指令" class="md-nav__link">
    指令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" title="指令参数" class="md-nav__link">
    指令参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" title="指令上下文" class="md-nav__link">
    指令上下文
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" title="单位" class="md-nav__link">
    单位
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" title="正则表达式" class="md-nav__link">
    正则表达式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" title="常用内置变量" class="md-nav__link">
    常用内置变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" title="自定义变量" class="md-nav__link">
    自定义变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" title="包含配置目录" class="md-nav__link">
    包含配置目录
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" title="配置示例" class="md-nav__link">
    配置示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-functionality" title="全局配置（core functionality)" class="md-nav__link">
    全局配置（core functionality)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user" title="user # 用户，用户组配置" class="md-nav__link">
    user # 用户，用户组配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker_processes" title="worker_processes # 工作线程数" class="md-nav__link">
    worker_processes # 工作线程数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker_cpu_affinity-cpu" title="worker_cpu_affinity # CPU绑定" class="md-nav__link">
    worker_cpu_affinity # CPU绑定
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker_connections" title="worker_connections # 单工作线程最大连接数" class="md-nav__link">
    worker_connections # 单工作线程最大连接数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker_rlimit_nofile" title="worker_rlimit_nofile # 最大文件描述符" class="md-nav__link">
    worker_rlimit_nofile # 最大文件描述符
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use" title="use # 事件模型" class="md-nav__link">
    use # 事件模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error_log" title="error_log # 日志存储位置" class="md-nav__link">
    error_log # 日志存储位置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pid-pid" title="pid # PID存储位置" class="md-nav__link">
    pid # PID存储位置
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httpngx_http_core_module" title="HTTP核心配置（ngx_http_core_module）" class="md-nav__link">
    HTTP核心配置（ngx_http_core_module）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client_header_buffer_size" title="client_header_buffer_size" class="md-nav__link">
    client_header_buffer_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client_body_buffer_size" title="client_body_buffer_size" class="md-nav__link">
    client_body_buffer_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen" title="listen" class="md-nav__link">
    listen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server_name" title="server_name" class="md-nav__link">
    server_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#location" title="location" class="md-nav__link">
    location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root" title="root" class="md-nav__link">
    root
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alias" title="alias" class="md-nav__link">
    alias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client_max_body_size-http-413" title="client_max_body_size # 大文件上传限制，超出返回HTTP 413" class="md-nav__link">
    client_max_body_size # 大文件上传限制，超出返回HTTP 413
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send_file" title="send_file # 直接发送文件" class="md-nav__link">
    send_file # 直接发送文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp_nopush" title="tcp_nopush" class="md-nav__link">
    tcp_nopush
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keepalive_timeout" title="keepalive_timeout # 连接超时时间" class="md-nav__link">
    keepalive_timeout # 连接超时时间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open_file_cache" title="open_file_cache # 文件句柄池" class="md-nav__link">
    open_file_cache # 文件句柄池
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open_file_cache_1" title="open_file_cache # 句柄有效时长" class="md-nav__link">
    open_file_cache # 句柄有效时长
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open_file_min_uses" title="open_file_min_uses # 去激活前最低使用次数" class="md-nav__link">
    open_file_min_uses # 去激活前最低使用次数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open_file_cache_error" title="open_file_cache_error # 是否缓存文件错误" class="md-nav__link">
    open_file_cache_error # 是否缓存文件错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aio-io" title="aio # 异步IO" class="md-nav__link">
    aio # 异步IO
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httpngx_http_log_module" title="HTTP日志配置（ngx_http_log_module）" class="md-nav__link">
    HTTP日志配置（ngx_http_log_module）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access_log" title="access_log" class="md-nav__link">
    access_log
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log_format" title="log_format" class="md-nav__link">
    log_format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open_log_file" title="open_log_file" class="md-nav__link">
    open_log_file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httpngx_http_charset_module" title="HTTP字符集配置（ngx_http_charset_module）" class="md-nav__link">
    HTTP字符集配置（ngx_http_charset_module）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charset" title="charset" class="md-nav__link">
    charset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source_charset" title="source_charset" class="md-nav__link">
    source_charset
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-gzipngx_http_gzip_module" title="HTTP gzip配置（ngx_http_gzip_module）" class="md-nav__link">
    HTTP gzip配置（ngx_http_gzip_module）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gzip-gzip" title="gzip # gzip开关" class="md-nav__link">
    gzip # gzip开关
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gzip_buffers-number" title="gzip_buffers number # 缓冲区大小" class="md-nav__link">
    gzip_buffers number # 缓冲区大小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gzip_comp_level" title="gzip_comp_level # 压缩级别" class="md-nav__link">
    gzip_comp_level # 压缩级别
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gzip_disable-user-agent" title="gzip_disable User-Agent过滤" class="md-nav__link">
    gzip_disable User-Agent过滤
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gzip_min_length" title="gzip_min_length 压缩最小长度" class="md-nav__link">
    gzip_min_length 压缩最小长度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gzip_types-mime" title="gzip_types 压缩mime类型" class="md-nav__link">
    gzip_types 压缩mime类型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-ngx_http_rewrite_module" title="HTTP 重定向配置（ngx_http_rewrite_module）" class="md-nav__link">
    HTTP 重定向配置（ngx_http_rewrite_module）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-server" title="Web Server" class="md-nav__link">
    Web Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-name" title="Server name" class="md-nav__link">
    Server name
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" title="匹配顺序" class="md-nav__link">
    匹配顺序
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#location_1" title="Location" class="md-nav__link">
    Location
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" title="普通匹配" class="md-nav__link">
    普通匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" title="精确匹配（=）" class="md-nav__link">
    精确匹配（=）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" title="正则匹配（~）" class="md-nav__link">
    正则匹配（~）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" title="停止正则匹配（^~）" class="md-nav__link">
    停止正则匹配（^~）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locationnameredirect" title="@locationname内部redirect匹配" class="md-nav__link">
    @locationname内部redirect匹配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" title="匹配顺序" class="md-nav__link">
    匹配顺序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" title="性能优化" class="md-nav__link">
    性能优化
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" title="返回状态码" class="md-nav__link">
    返回状态码
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" title="无参数状态码" class="md-nav__link">
    无参数状态码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" title="带参数状态吗" class="md-nav__link">
    带参数状态吗
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlrewrite" title="重写URL（rewrite）" class="md-nav__link">
    重写URL（rewrite）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rewrite" title="rewrite" class="md-nav__link">
    rewrite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#last" title="last" class="md-nav__link">
    last
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#break" title="break" class="md-nav__link">
    break
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirect-permanent" title="redirect | permanent" class="md-nav__link">
    redirect | permanent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serverrewrite" title="server中rewrite会按顺序执行一次" class="md-nav__link">
    server中rewrite会按顺序执行一次
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locationrewritelocation" title="location中rewrite在选中location时会执行" class="md-nav__link">
    location中rewrite在选中location时会执行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http" title="重写HTTP" class="md-nav__link">
    重写HTTP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#httprefer" title="更改http请求refer" class="md-nav__link">
    更改http请求refer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#host-name" title="更改host name" class="md-nav__link">
    更改host name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" title="错误处理" class="md-nav__link">
    错误处理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" title="定义错误页" class="md-nav__link">
    定义错误页
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" title="替换错误码" class="md-nav__link">
    替换错误码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" title="将错误转交处理" class="md-nav__link">
    将错误转交处理
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-proxy" title="反向代理 Reverse Proxy" class="md-nav__link">
    反向代理 Reverse Proxy
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" title="转发请求" class="md-nav__link">
    转发请求
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_39" title="转发到网址" class="md-nav__link">
    转发到网址
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" title="转发到IP端口" class="md-nav__link">
    转发到IP端口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#location_2" title="替换location" class="md-nav__link">
    替换location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fastcgi" title="FastCGI" class="md-nav__link">
    FastCGI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uwsgi" title="uwsgi" class="md-nav__link">
    uwsgi
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scgi" title="SCGI" class="md-nav__link">
    SCGI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memcached" title="memcached" class="md-nav__link">
    memcached
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#named-group" title="named group（即负载均衡）" class="md-nav__link">
    named group（即负载均衡）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" title="修改转发请求头部" class="md-nav__link">
    修改转发请求头部
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxy_set_header" title="proxy_set_header" class="md-nav__link">
    proxy_set_header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hosthost" title="设置Host为原始Host" class="md-nav__link">
    设置Host为原始Host
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipip" title="设置真实IP为原始IP" class="md-nav__link">
    设置真实IP为原始IP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" title="阻止某个字段传给代理（设置为空）" class="md-nav__link">
    阻止某个字段传给代理（设置为空）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" title="配置缓存" class="md-nav__link">
    配置缓存
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxy_buffering" title="proxy_buffering（开关）" class="md-nav__link">
    proxy_buffering（开关）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy_buffers" title="proxy_buffers（单连接缓存大小块数）" class="md-nav__link">
    proxy_buffers（单连接缓存大小块数）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy_buffer_size" title="proxy_buffer_size（响应读取阈值）" class="md-nav__link">
    proxy_buffer_size（响应读取阈值）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy_buffer" title="低延迟交互应用时关闭proxy_buffer（同步处理）" class="md-nav__link">
    低延迟交互应用时关闭proxy_buffer（同步处理）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip_1" title="绑定出口IP" class="md-nav__link">
    绑定出口IP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ip_2" title="绑定IP" class="md-nav__link">
    绑定IP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" title="绑定变量" class="md-nav__link">
    绑定变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#content-caching" title="内容缓存 Content Caching" class="md-nav__link">
    内容缓存 Content Caching
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" title="开启响应缓存" class="md-nav__link">
    开启响应缓存
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxy_cache" title="proxy_cache 开启或关闭代理缓存" class="md-nav__link">
    proxy_cache 开启或关闭代理缓存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy_cache_path" title="proxy_cache_path 定义缓存区" class="md-nav__link">
    proxy_cache_path 定义缓存区
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keys_zone" title="keys_zone # 定义缓存区名称，大小，超时时间，" class="md-nav__link">
    keys_zone # 定义缓存区名称，大小，超时时间，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#levels" title="levels # 指定缓存子目录数" class="md-nav__link">
    levels # 指定缓存子目录数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inactive" title="inactive" class="md-nav__link">
    inactive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use_temp_path" title="use_temp_path" class="md-nav__link">
    use_temp_path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" title="设置缓存加载" class="md-nav__link">
    设置缓存加载
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loader_threshold" title="loader_threshold" class="md-nav__link">
    loader_threshold
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loader_files" title="loader_files" class="md-nav__link">
    loader_files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loader_sleeps" title="loader_sleeps" class="md-nav__link">
    loader_sleeps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" title="示例" class="md-nav__link">
    示例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" title="缓存设置" class="md-nav__link">
    缓存设置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key" title="设置缓存key计算方法" class="md-nav__link">
    设置缓存key计算方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" title="设置缓存条件：最小请求次数（只有被最常访问的数据才被缓存）" class="md-nav__link">
    设置缓存条件：最小请求次数（只有被最常访问的数据才被缓存）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" title="设置缓存methods" class="md-nav__link">
    设置缓存methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" title="缓存更新锁" class="md-nav__link">
    缓存更新锁
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" title="使用缓存替代错误相应" class="md-nav__link">
    使用缓存替代错误相应
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" title="缓存正在更新时，先发送旧内容，触发更新的请求会等待服务器返回新结果" class="md-nav__link">
    缓存正在更新时，先发送旧内容，触发更新的请求会等待服务器返回新结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" title="限制或绕过缓存" class="md-nav__link">
    限制或绕过缓存
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" title="设置缓存过期时间" class="md-nav__link">
    设置缓存过期时间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" title="按状态码设置缓存过期时间" class="md-nav__link">
    按状态码设置缓存过期时间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-0" title="如果有string参数为空 或 值参数不等于0 则不缓存" class="md-nav__link">
    如果有string参数为空 或 值参数不等于0 则不缓存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-0_1" title="如果有string不为空 或 值不等于0 则不缓存" class="md-nav__link">
    如果有string不为空 或 值不等于0 则不缓存
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#purge" title="缓存手动老化 PURGE" class="md-nav__link">
    缓存手动老化 PURGE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" title="缓存分段" class="md-nav__link">
    缓存分段
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" title="综合配置示例" class="md-nav__link">
    综合配置示例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_57" title="静态文件" class="md-nav__link">
    静态文件
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rootindex" title="root目录和Index文件" class="md-nav__link">
    root目录和Index文件
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#root_1" title="root使用示例" class="md-nav__link">
    root使用示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#location_3" title="以斜杠"\"结尾的location" class="md-nav__link">
    以斜杠"\"结尾的location
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoindex-indexhtml" title="autoindex 自动创建index.html" class="md-nav__link">
    autoindex 自动创建index.html
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-index" title="index 定义index文件名称" class="md-nav__link">
    index 定义index文件名称
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try_file" title="try_file" class="md-nav__link">
    try_file
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_58" title="不存在则重定向到默认" class="md-nav__link">
    不存在则重定向到默认
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#404" title="尝试一系列形式，不存在则404" class="md-nav__link">
    尝试一系列形式，不存在则404
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy" title="找不到文件则转到proxy" class="md-nav__link">
    找不到文件则转到proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" title="性能优化" class="md-nav__link">
    性能优化
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#send_file_1" title="send_file 直接发送文件" class="md-nav__link">
    send_file 直接发送文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sendfile_max_chunk" title="sendfile_max_chunk 最大一次发送数据量" class="md-nav__link">
    sendfile_max_chunk 最大一次发送数据量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp_nopush_1" title="tcp_nopush" class="md-nav__link">
    tcp_nopush
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp_nodelay" title="tcp_nodelay" class="md-nav__link">
    tcp_nodelay
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp" title="增加tcp监听队列长度" class="md-nav__link">
    增加tcp监听队列长度
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_60" title="正向代理配置示例" class="md-nav__link">
    正向代理配置示例
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_61" title="反向代理配置示例" class="md-nav__link">
    反向代理配置示例
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" title="例1：" class="md-nav__link">
    例1：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" title="例2：" class="md-nav__link">
    例2：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" title="例3：" class="md-nav__link">
    例3：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl" title="ssl" class="md-nav__link">
    ssl
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl_protocols-ssl" title="ssl_protocols SSL协议" class="md-nav__link">
    ssl_protocols SSL协议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl_ciphers-ssl" title="ssl_ciphers SSL加密" class="md-nav__link">
    ssl_ciphers SSL加密
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl_session_cache-sslcache" title="ssl_session_cache SSL会话Cache性能优化" class="md-nav__link">
    ssl_session_cache SSL会话Cache性能优化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl_session_time-ssl" title="ssl_session_time SSL会话超时时间" class="md-nav__link">
    ssl_session_time SSL会话超时时间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crt" title="为缺少中间证书的浏览器添加crt中间证书" class="md-nav__link">
    为缺少中间证书的浏览器添加crt中间证书
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" title="配置示例" class="md-nav__link">
    配置示例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" title="消息转发" class="md-nav__link">
    消息转发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" title="生成方法" class="md-nav__link">
    生成方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" title="分解生成方法" class="md-nav__link">
    分解生成方法
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_66" title="负载均衡" class="md-nav__link">
    负载均衡
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns" title="DNS负载均衡" class="md-nav__link">
    DNS负载均衡
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_67" title="重定向" class="md-nav__link">
    重定向
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#websocket" title="websocket代理" class="md-nav__link">
    websocket代理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx-httl-hls-module" title="nginx httl hls module" class="md-nav__link">
    nginx httl hls module
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/yingxuanxuan/yingxuanxuan.github.io/edit/master/docs/nginx.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                  <h1>Ningx</h1>
                
                <h2 id="_1">文档<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/docs/">http://nginx.org/en/docs/</a></p>
<h2 id="_2">安装<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/linux_packages.html">http://nginx.org/en/linux_packages.html</a></p>
<h3 id="repo">repo 安装<a class="headerlink" href="#repo" title="Permanent link">&para;</a></h3>
<h4 id="repo_1">repo<a class="headerlink" href="#repo_1" title="Permanent link">&para;</a></h4>
<p>/etc/yum.repos.d/nginx.repo   </p>
<pre class="codehilite"><code>[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/mainline/OS/OSRELEASE/$basearch/
gpgcheck=0/1
enabled=1</code></pre>


<p>参数说明：<br />
OS: rhel/centos<br />
OSRELEASE: 5/6/7  </p>
<h4 id="repo_2">导入repo签名<a class="headerlink" href="#repo_2" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">wget http://nginx.org/keys/nginx_signing.key  
sudo rpm --import nginx_signing.key  </code></pre>


<h3 id="_3">编译安装<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>--prefix=/etc/nginx<br />
--sbin-path=/usr/sbin/nginx<br />
--conf-path=/etc/nginx/nginx.conf<br />
--error-log-path=/var/log/nginx/error.log<br />
--http-log-path=/var/log/nginx/access.log<br />
--pid-path=/var/run/nginx.pid<br />
--lock-path=/var/run/nginx.lock<br />
--http-client-body-temp-path=/var/cache/nginx/client_temp<br />
--http-proxy-temp-path=/var/cache/nginx/proxy_temp<br />
--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp<br />
--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp<br />
--http-scgi-temp-path=/var/cache/nginx/scgi_temp<br />
--user=nginx<br />
--group=nginx  </p>
<h2 id="_4">操作命令<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="_5">信号<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-sh">nginx -s stop # fast shutdown  
nginx -s quit # graceful shutdown  
nginx -s reload # reloading config  
nginx -s reopen # reopen log  </code></pre>


<h3 id="_6">命令<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<h4 id="_7">测试配置<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">sudo nginx -t  
sudo nginx -T 测试并打印配置  </code></pre>


<h4 id="_8">查看编译选项<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">sudo nginx -V  </code></pre>


<h4 id="_9">使用新配置<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">sudo nginx -c new.conf  </code></pre>


<h4 id="_10">动态改变配置<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">sudo nginx -g &quot;pid /var/run/nginx/pid; worker_process `sysctl -n hw.ncpu`;&quot;  </code></pre>


<h3 id="_11">服务<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-sh">service nginx {start|stop|status|restart|reload|configtest}   </code></pre>


<h2 id="_12">配置<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<h3 id="_13">配置概述<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<h4 id="_14">注释<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>行内从'#'开始都是注释  </p>
<h4 id="_15">指令<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>指令是一个字符串，可以使用单引号或双引号引起来，一般不用除非指令包含空格  </p>
<h4 id="_16">指令参数<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<p>使用空格和TAB分开，参数包含复合配置块的使用大括号括起来。  </p>
<h4 id="_17">指令上下文<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>main：业务功能无关参数<br />
http：http服务相关配置参数<br />
location：特定URL配置参数<br />
mail：email相关代理共享配置项  </p>
<h4 id="_18">单位<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>千字节：k,K<br />
兆字节：m,M<br />
毫秒：ms<br />
秒：s<br />
分钟：m<br />
小时：h<br />
日：d<br />
周：w<br />
月，30天：M<br />
年，365天：y  </p>
<h4 id="_19">正则表达式<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>.：匹配除换行符以外的任意字符<br />
?：重复0次或1次<br />
+：重复1次或更多次<br />
*：重复0次或更多次<br />
\d：匹配数字 <br />
^：开头<br />
$：末尾<br />
{n}：重复n次<br />
{n,}：重复n次或更多次<br />
[c]：匹配单个字符c<br />
[a-c]：匹配a-z任意  </p>
<p>()：使用$1, $2引用括号中内容<br />
\：转译特殊字符  </p>
<p>".(mp4|mov|avi)$"：mp4或mov或avi  </p>
<h4 id="_20">常用内置变量<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<p><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#variables">http://nginx.org/en/docs/http/ngx_http_core_module.html#variables</a><br />
$arg_name：请求 uri 中的 name 参数至<br />
$args：请求 uri 的所有参数，和 $query_string 相同<br />
$uri：当前请求的 uri，不带参数<br />
$request_uri：请求的 uri，带完整参数<br />
$host：http 请求报文中 host 首部，如果没有 host 首部，则以处理此请求的虚拟主机的主机名替代<br />
$hostname：nginx 服务运行在主机的主机名<br />
$remote_addr：客户端 IP<br />
$remote_port：客户端 port<br />
$remote_user：使用用户认证时客户端用户输入的用户名<br />
$request_filename：用户请求中的 URI 经过本地 root  或 alias 转换后映射的本地的文件路径<br />
$request_method：请求方法<br />
$server_addr：服务器地址<br />
$server_name：服务器名称<br />
$server_port：服务器端口<br />
$server_protocol：服务器向客户端发送响应时的协议，如 http/1.1，http/1.0<br />
$scheme：在请求中使用的 scheme，如 https://www.magedu.com/ 中的 https<br />
$http_name：匹配请求报文中的指定 HEADER，如 $http_host 匹配请求报文中的 host 首部<br />
$sent_http_name：匹配响应报文中指定的 HEADER，例如 $sent_content_type 匹配响应报文中的 content-type 首部<br />
$status：响应状态  </p>
<h4 id="_21">自定义变量<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#set">set</a><br />
<a href="http://nginx.org/en/docs/http/ngx_http_map_module.html#map">map</a><br />
<a href="http://nginx.org/en/docs/http/ngx_http_geo_module.html#geo">geo</a>  </p>
<h4 id="_22">包含配置目录<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code>http {
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*.conf;
    include /etc/nginx/sites-enabled/my_own_conf;
    ...
}</code></pre>


<h3 id="_23">配置示例<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-nginx">http{
    # http1
    server {
        listen 80;

        # 指定监听IP
        listen 192.168.1.1:80;

        # 指定默认服务器
        listen 80 default_server; 

        # 指定Host
        server_name www.com www.www.com; 

        # 拒绝没有Host的请求
        server_name &quot;&quot;;
        return 444;

        # URL相对地址
        location / { 
            root /linux/path; # 静态网页地址
        } 

        # 代理转发
        location /proxy/ { 
            proxy_pass http://localhost:8080;
        }

        # 正则表达式（~开头）
        location ~ \.(gif|jpg|png)$ {
            root /data/images;
        }
    }

    # http2
    server {
        listen 8080;     
    }
}</code></pre>


<h3 id="core-functionality">全局配置（core functionality)<a class="headerlink" href="#core-functionality" title="Permanent link">&para;</a></h3>
<h4 id="user">user # 用户，用户组配置<a class="headerlink" href="#user" title="Permanent link">&para;</a></h4>
<p>语法：user nginx nginx;</p>
<h4 id="worker_processes">worker_processes # 工作线程数<a class="headerlink" href="#worker_processes" title="Permanent link">&para;</a></h4>
<p>语法：worker_processes 2<br />
默认值：与CPU核数相同<br />
上下文：main  </p>
<p>CPU核数：<code>grep ^processor /proc/cpuinfo | wc -l</code><br />
若开启ssl和gzip应该设置为CPU核数2倍，可以减少I/O操作  </p>
<h4 id="worker_cpu_affinity-cpu">worker_cpu_affinity # CPU绑定<a class="headerlink" href="#worker_cpu_affinity-cpu" title="Permanent link">&para;</a></h4>
<p>语法：worker_cpu_affinity 0001 0010 0100 1000<br />
上下文：main  </p>
<h4 id="worker_connections">worker_connections # 单工作线程最大连接数<a class="headerlink" href="#worker_connections" title="Permanent link">&para;</a></h4>
<p>语法：worker_connections number<br />
默认：worker_connections 512<br />
上下文：events  </p>
<p>最大连接数是 worker_connections * worker_processes<br />
反响代理会占用两个连接，最大连接数是 worker_connections * worker_processes / 2  </p>
<h4 id="worker_rlimit_nofile">worker_rlimit_nofile # 最大文件描述符<a class="headerlink" href="#worker_rlimit_nofile" title="Permanent link">&para;</a></h4>
<p>语法：worker_rlimit_nofile 10240<br />
默认值：N/A<br />
上下文：main  </p>
<p>与ulimit -n最大可能值相同，超过会返回502错误  </p>
<h4 id="use">use # 事件模型<a class="headerlink" href="#use" title="Permanent link">&para;</a></h4>
<p>语法：use {epoll|kqueue|select|poll|/dev/poll|eventport}<br />
默认值：Linux下默认为epoll，Unix为kqueue，操作系统不支持时使用select<br />
上下文：event  </p>
<h4 id="error_log">error_log # 日志存储位置<a class="headerlink" href="#error_log" title="Permanent link">&para;</a></h4>
<p>语法：error_log file [level];<br />
默认：error_log logs/error.log error;<br />
上下文：main, http, mail, stream, server, location  </p>
<p>日志级别：<br />
debug, info, notice, warn, error, crit, alert, or emerg  </p>
<p>debug需要开启--with-debug编译选项<br />
1.7.11以上可以设置stream日志级别<br />
1.9.0以上可以设置mail日志级别  </p>
<h4 id="pid-pid">pid # PID存储位置<a class="headerlink" href="#pid-pid" title="Permanent link">&para;</a></h4>
<p>语法：pid /path/to/pid;  </p>
<h3 id="httpngx_http_core_module">HTTP核心配置（ngx_http_core_module）<a class="headerlink" href="#httpngx_http_core_module" title="Permanent link">&para;</a></h3>
<h4 id="client_header_buffer_size">client_header_buffer_size<a class="headerlink" href="#client_header_buffer_size" title="Permanent link">&para;</a></h4>
<p>语法：client_header_buffer_size size;<br />
默认：1K<br />
上下文：http, server  </p>
<p>使用getconf PAGESIZE获取linux系统分页大小，一般设置为系统分页的整数倍。  </p>
<h4 id="client_body_buffer_size">client_body_buffer_size<a class="headerlink" href="#client_body_buffer_size" title="Permanent link">&para;</a></h4>
<p>语法：client_body_buffer_size size;<br />
默认：32bit 8k | 64bit 16k<br />
上下文：http, server, location  </p>
<h4 id="listen">listen<a class="headerlink" href="#listen" title="Permanent link">&para;</a></h4>
<p>语法：listen address[:port] [default_server] [ssl] <br />
          listen port [default_server] [ssl] <br />
默认：listen <em>:80 | </em>:8000;<br />
上下文：server  </p>
<p>不配置listen时，默认使用80端口，若nginx有root权限则使用8000端口<br />
default_server，一个端口下host不匹配时默认的服务器<br />
ssl，0.7.14以前的版本，一个Server必须全部是http或https，ssl使一个server可以同时是http和https  </p>
<h4 id="server_name">server_name<a class="headerlink" href="#server_name" title="Permanent link">&para;</a></h4>
<p>语法：server_name name ...;<br />
默认：server_name "";<br />
上下文：server  </p>
<p>server_name example.com www.example.com;<br />
server_name example.com <em>.example.com www.example.</em>;<br />
server_name .example.com;<br />
server_name ~^www\d+.example.com$;<br />
server_name _; （使用上一个server_name）<br />
server_name ""; （接受不存在Host字段的请求）  </p>
<h4 id="location">location<a class="headerlink" href="#location" title="Permanent link">&para;</a></h4>
<p>语法：location [ = | ~ | ~* | ^~ ] uri { ... }<br />
            location @name { ... }<br />
默认：    —<br />
上下文：server, location  </p>
<p>会解析%xx格式文字<br />
会解析相对路径 . 或 .. <br />
默认会合并相邻斜杠（merge_slashes on）</p>
<p>如果location请求被proxy_pass、fastcgi_pass、uwsgi_pass、scgi_pass、memcached_pass处理，若如”location /user/“带斜杠，则会正常处理。若如”location /user“不带斜杠，ngxin会发送一个301重定向到"location /user/"。若这并不是所要的，需要分别定义“location /user/”和“location /user”。</p>
<p>URL带斜杠\表示目录，不带斜杠表示文件。不加斜杠访问会尝试访问文件，不存在时返回301重定向到带斜杠\的地址。<br />
如http://www.example.com/后可以直接加斜杠。但是"http://www.example.com/user"不知道是否加斜杠，可能会造成一次不必要的请求。  </p>
<h4 id="root">root<a class="headerlink" href="#root" title="Permanent link">&para;</a></h4>
<p>语法：root path;<br />
默认：root html;<br />
上下文：http, server, location, if in location  </p>
<h4 id="alias">alias<a class="headerlink" href="#alias" title="Permanent link">&para;</a></h4>
<p>语法：alias path<br />
默认：-<br />
上下文：location  </p>
<p>可以使用正则表达式：  </p>
<pre class="codehilite"><code class="language-nginx">location ~ ^/users/(.+\.(?:gif|jpe?g|png))$ {  
    alias /data/w3/images/$1;  
}  </code></pre>


<p>root与alias比较：<br />
使用root指令，location的完整地址会附加到root的地址后面<br />
使用alias指令，location中不匹配的部分会附加到alias的地址后面  </p>
<h4 id="client_max_body_size-http-413">client_max_body_size # 大文件上传限制，超出返回HTTP 413<a class="headerlink" href="#client_max_body_size-http-413" title="Permanent link">&para;</a></h4>
<p>语法：client_max_body_size size;<br />
默认：client_max_body_size 1m;<br />
上下文：http, server, location  </p>
<h4 id="send_file">send_file # 直接发送文件<a class="headerlink" href="#send_file" title="Permanent link">&para;</a></h4>
<p>语法：sendfile on | off;<br />
默认：sendfile off;<br />
上下文：http, server, location, if in location<br />
默认nginx会把文件copy到内存后再发送，打开send_file后会直接从文件fd复制到socket fd。  </p>
<h4 id="tcp_nopush">tcp_nopush<a class="headerlink" href="#tcp_nopush" title="Permanent link">&para;</a></h4>
<p>语法：tcp_nopush on | off;<br />
默认：tcp_nopush off;<br />
上下文：http, server, location  </p>
<p>在一个包中发送响应头和文件<br />
数据包累积满时才发送<br />
依赖于sendfile打开   </p>
<h4 id="keepalive_timeout">keepalive_timeout # 连接超时时间<a class="headerlink" href="#keepalive_timeout" title="Permanent link">&para;</a></h4>
<p>语法：keepalive_timeout timeout [header_timeout];<br />
默认：keepalive_timeout 75s;<br />
上下文：http, server, location  </p>
<p>设置为0即关闭<br />
header_timeout：设置响应头"Keep-Alive: timeout=time"，可以和服务器端不一致  </p>
<h4 id="open_file_cache">open_file_cache # 文件句柄池<a class="headerlink" href="#open_file_cache" title="Permanent link">&para;</a></h4>
<p>语法：open_file_cache off;<br />
          open_file_cache max=N [inactive=time];<br />
默认：open_file_cache off;<br />
上下文：http, server, location  </p>
<h4 id="open_file_cache_1">open_file_cache # 句柄有效时长<a class="headerlink" href="#open_file_cache_1" title="Permanent link">&para;</a></h4>
<p>语法：open_file_cache_valid time;<br />
默认：open_file_cache_valid 60s;<br />
上下文：http, server, location  </p>
<h4 id="open_file_min_uses">open_file_min_uses # 去激活前最低使用次数<a class="headerlink" href="#open_file_min_uses" title="Permanent link">&para;</a></h4>
<p>语法：open_file_cache_min_uses number;<br />
默认：open_file_cache_min_uses 1;<br />
上下文：http, server, location  </p>
<h4 id="open_file_cache_error">open_file_cache_error # 是否缓存文件错误<a class="headerlink" href="#open_file_cache_error" title="Permanent link">&para;</a></h4>
<p>语法：open_file_cache_errors on | off;<br />
默认：open_file_cache_errors off;<br />
上下文：http, server, location  </p>
<h4 id="aio-io">aio # 异步IO<a class="headerlink" href="#aio-io" title="Permanent link">&para;</a></h4>
<p>语法：aio on | off | threads[=pool];<br />
默认：aio off;<br />
上下文：http, server, location  </p>
<h3 id="httpngx_http_log_module">HTTP日志配置（ngx_http_log_module）<a class="headerlink" href="#httpngx_http_log_module" title="Permanent link">&para;</a></h3>
<h4 id="access_log">access_log<a class="headerlink" href="#access_log" title="Permanent link">&para;</a></h4>
<p>语法：access_log path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]];<br />
          access_log off;<br />
默认：access_log logs/access.log combined;<br />
上下文：http, server, location, if in location, limit_except  </p>
<h4 id="log_format">log_format<a class="headerlink" href="#log_format" title="Permanent link">&para;</a></h4>
<p>语法：log_format name string ...;<br />
默认：log_format combined "...";<br />
上下文：http  </p>
<p>系统变量：<br />
<a href="http://nginx.org/en/docs/varindex.html">http://nginx.org/en/docs/varindex.html</a></p>
<p>日志变量：<br />
$bytes_sent：发送给客户端的字节数<br />
$connection：连接序号<br />
$connection_requests：当前连接请求序号<br />
$msec：日志写入millisecond时间戳<br />
$pipe：“p” if request was pipelined, “.” otherwise<br />
$request_length：请求长度 (包含request line, header, and request body)<br />
$request_time：请求时间，从收到第一个字节到响应最后一个字节的时间段 <br />
$status：响应状态<br />
$time_iso8601：ISO 8601格式的本地实际<br />
$time_local：本地时间  </p>
<p>预定义combined日志格式：  </p>
<pre class="codehilite"><code>log_format combined '$remote_addr - $remote_user [$time_local] '  
                    '&quot;$request&quot; $status $body_bytes_sent '  
                    '&quot;$http_referer&quot; &quot;$http_user_agent&quot;';  </code></pre>


<h4 id="open_log_file">open_log_file<a class="headerlink" href="#open_log_file" title="Permanent link">&para;</a></h4>
<p>语法：open_log_file_cache max=N [inactive=time] [min_uses=N] [valid=time];<br />
          open_log_file_cache off;<br />
默认：open_log_file_cache off;<br />
上下文：http, server, location  </p>
<h3 id="httpngx_http_charset_module">HTTP字符集配置（ngx_http_charset_module）<a class="headerlink" href="#httpngx_http_charset_module" title="Permanent link">&para;</a></h3>
<h4 id="charset">charset<a class="headerlink" href="#charset" title="Permanent link">&para;</a></h4>
<p>语法：charset charset | off;<br />
默认：charset off;<br />
上下文：http, server, location, if in location  </p>
<h4 id="source_charset">source_charset<a class="headerlink" href="#source_charset" title="Permanent link">&para;</a></h4>
<p>语法：source_charset charset;<br />
默认：—<br />
上下文：http, server, location, if in location  </p>
<h3 id="http-gzipngx_http_gzip_module">HTTP gzip配置（ngx_http_gzip_module）<a class="headerlink" href="#http-gzipngx_http_gzip_module" title="Permanent link">&para;</a></h3>
<h4 id="gzip-gzip">gzip # gzip开关<a class="headerlink" href="#gzip-gzip" title="Permanent link">&para;</a></h4>
<p>语法：gzip on | off;<br />
默认：gzip off;<br />
上下文：http, server, location, if in location  </p>
<h4 id="gzip_buffers-number">gzip_buffers number # 缓冲区大小<a class="headerlink" href="#gzip_buffers-number" title="Permanent link">&para;</a></h4>
<p>语法：gzip_buffers number size;<br />
默认：gzip_buffers 32 4k|16 8k;<br />
上下文：http, server, location  </p>
<h4 id="gzip_comp_level">gzip_comp_level # 压缩级别<a class="headerlink" href="#gzip_comp_level" title="Permanent link">&para;</a></h4>
<p>语法：gzip_comp_level level;<br />
默认：gzip_comp_level 1;<br />
上下文：http, server, location  </p>
<p>压缩级别：1-9  </p>
<h4 id="gzip_disable-user-agent">gzip_disable User-Agent过滤<a class="headerlink" href="#gzip_disable-user-agent" title="Permanent link">&para;</a></h4>
<p>语法：gzip_disable regex ...;<br />
默认：—<br />
上下文：http, server, location  </p>
<p>例如：<code>gzip_disable "MSIE [4-6]\."</code></p>
<h4 id="gzip_min_length">gzip_min_length 压缩最小长度<a class="headerlink" href="#gzip_min_length" title="Permanent link">&para;</a></h4>
<p>语法：gzip_min_length length;<br />
默认：gzip_min_length 20;<br />
上下文：http, server, location  </p>
<h4 id="gzip_types-mime">gzip_types 压缩mime类型<a class="headerlink" href="#gzip_types-mime" title="Permanent link">&para;</a></h4>
<p>语法：gzip_types mime-type ...;<br />
默认：gzip_types text/html;<br />
上下文：http, server, location  </p>
<p>text/html总是会被压缩<br />
使用"*"压缩所有类型   </p>
<h3 id="http-ngx_http_rewrite_module">HTTP 重定向配置（ngx_http_rewrite_module）<a class="headerlink" href="#http-ngx_http_rewrite_module" title="Permanent link">&para;</a></h3>
<p><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html</a></p>
<h2 id="web-server">Web Server<a class="headerlink" href="#web-server" title="Permanent link">&para;</a></h2>
<h3 id="server-name">Server name<a class="headerlink" href="#server-name" title="Permanent link">&para;</a></h3>
<h4 id="_24">匹配顺序<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h4>
<p>1、Exact name<br />
2、Longest wildcard starting with an asterisk, such as <em>.example.org<br />
3、Longest wildcard ending with an asterisk, such as mail.</em><br />
4、First matching regular expression (in order of appearance in the configuration file)<br />
5、default_server  </p>
<h3 id="location_1">Location<a class="headerlink" href="#location_1" title="Permanent link">&para;</a></h3>
<h4 id="_25">普通匹配<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h4>
<p>location /<br />
location /image<br />
按最长匹配规则，所有URI都会匹配（location /）规则，正则表达式和比（location /）长的匹配（如 location /image）会优先匹配  </p>
<h4 id="_26">精确匹配（=）<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h4>
<p>location = /<br />
location = /test<br />
最长匹配，匹配后不再检查其他规则  </p>
<h4 id="_27">正则匹配（~）<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h4>
<p>tilde（~）：默认正则大小写敏感匹配<br />
tilde-asterisk（~*）：忽略大小写  </p>
<p>忽略大小写匹配.html 和.htm  </p>
<pre class="codehilite"><code>location ~* \.html?  </code></pre>


<h4 id="_28">停止正则匹配（^~）<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h4>
<p>在路径中找到最长匹配后，不再检查正则表达式  </p>
<h4 id="locationnameredirect">@locationname内部redirect匹配<a class="headerlink" href="#locationnameredirect" title="Permanent link">&para;</a></h4>
<p>location @locationname  </p>
<pre class="codehilite"><code class="language-nginx">error_page 404 = @fetch;

location @fetch{
  proxy_pass http://fetch;
}</code></pre>


<h4 id="_29">匹配顺序<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h4>
<p>1、Test the URI against all prefix strings (pathnames).<br />
      使用（against）全部路径检查URI<br />
2、The = (equals sign) modifier defines an exact match of the URI and a prefix string (pathnames). <br />
      If the exact match is found, the search stops.<br />
      检查是否有精确匹配（=），如果精确匹配被找到则停止搜索<br />
3、If the ^~ (caret-tilde) modifier prepends the longest matching prefix string (pathnames), the regular expressions are not checked.<br />
      检查最长匹配中，如果有最短匹配（^~）符号，则忽略正则表达式（已经是最长匹配）<br />
4、Store the longest matching prefix string (pathnames).<br />
      存储最长匹配的路径<br />
5、Test the URI against regular expressions.<br />
      使用（against）全部正则表达式检查URI<br />
6、Break on the first matching regular expression and use the corresponding location.<br />
      正则表达式中按配置顺序匹配<br />
7、If no regular expression matches, use the location corresponding to the stored prefix string (pathnames).<br />
      没有正则表达式匹配则使用前面存储的路径  </p>
<h4 id="_30">性能优化<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h4>
<p>一般首页最常用，配置为：  </p>
<pre class="codehilite"><code class="language-nginx">location = / {
    proxy_pass http://example.com/index.html
}</code></pre>


<p>静态文件提高效率，使用最短匹配，不再检查正则表达式规则：  </p>
<pre class="codehilite"><code class="language-nginx">location ^~ /static/ {
    root /static/;
}</code></pre>


<p>或  </p>
<pre class="codehilite"><code class="language-nginx">location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ {
    root /res/;
}</code></pre>


<p>所有未被匹配的内容，使用通用匹配转发至后端：  </p>
<pre class="codehilite"><code class="language-nginx">location / {
    proxy_pass http://example.com/index.html
}</code></pre>


<h3 id="_31">返回状态码<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<h4 id="_32">无参数状态码<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location /wrong/url {
    return 404;
}</code></pre>


<h4 id="_33">带参数状态吗<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location /permanently/moved/url {
    return 301 http://www.example.com/moved/here;
}</code></pre>


<h3 id="urlrewrite">重写URL（rewrite）<a class="headerlink" href="#urlrewrite" title="Permanent link">&para;</a></h3>
<h4 id="rewrite">rewrite<a class="headerlink" href="#rewrite" title="Permanent link">&para;</a></h4>
<p>语法：rewrite regular_expression new_uri [break|last|redirect|permanent]<br />
上下文：server, location, if  </p>
<p>uri重写后会重新选择location<br />
rewrite值对域名之后的，除去查询参数的部分起作用，例如http://a.com/a/we/index.php?id=1&amp;u=str，只对/a/we/index.php起作用  </p>
<h4 id="last">last<a class="headerlink" href="#last" title="Permanent link">&para;</a></h4>
<p>停止当前server或location中的rewrite，但是rewrite后的uri会继续查找location，location可能还会执行rewrite。  </p>
<h4 id="break">break<a class="headerlink" href="#break" title="Permanent link">&para;</a></h4>
<p>停止当前server或location中的rewrite，rewrite后的uri不会继续查找location。  </p>
<h4 id="redirect-permanent">redirect | permanent<a class="headerlink" href="#redirect-permanent" title="Permanent link">&para;</a></h4>
<p>redirect 302临时重定向<br />
permanent 301永久重定向  </p>
<h4 id="serverrewrite">server中rewrite会按顺序执行一次<a class="headerlink" href="#serverrewrite" title="Permanent link">&para;</a></h4>
<h4 id="locationrewritelocation">location中rewrite在选中location时会执行<a class="headerlink" href="#locationrewritelocation" title="Permanent link">&para;</a></h4>
<h3 id="http">重写HTTP<a class="headerlink" href="#http" title="Permanent link">&para;</a></h3>
<h4 id="httprefer">更改http请求refer<a class="headerlink" href="#httprefer" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location / {
    sub_filter /blog/ /blog-staging/;
    sub_filter_once off;
}</code></pre>


<h4 id="host-name">更改host name<a class="headerlink" href="#host-name" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location / {
    sub_filter 'href=&quot;http://127.0.0.1:8080/' 'href=&quot;http://$host/';
    sub_filter 'img src=&quot;http://127.0.0.1:8080/' 'img src=&quot;http://$host/';
    sub_filter_once on;
}</code></pre>


<h3 id="_34">错误处理<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<h4 id="_35">定义错误页<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">error_page 404 /404.html</code></pre>


<h4 id="_36">替换错误码<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location /old/path.html {
    error_page 404 =301 http://example.com/new/path.html;
}</code></pre>


<h4 id="_37">将错误转交处理<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">server {
    location /images/ {
        error_page 404 = /fetch$uri;
    }

    location /fetch/ {
        proxy_pass http://backend/;
    }
}</code></pre>


<h2 id="reverse-proxy">反向代理 Reverse Proxy<a class="headerlink" href="#reverse-proxy" title="Permanent link">&para;</a></h2>
<h3 id="_38">转发请求<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h3>
<h4 id="_39">转发到网址<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">proxy_pass http://www.example.com</code></pre>


<h4 id="ip">转发到IP端口<a class="headerlink" href="#ip" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">proxy_pass http://127.0.0.1:8000</code></pre>


<h4 id="location_2">替换location<a class="headerlink" href="#location_2" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location /some/path/ {
    proxy_pass http://www.example.com/link/;
}</code></pre>


<p>假设访问/some/path/page.html<br />
会替换成/link/page.html  </p>
<h4 id="fastcgi">FastCGI<a class="headerlink" href="#fastcgi" title="Permanent link">&para;</a></h4>
<p>fastcgi_pass</p>
<h4 id="uwsgi">uwsgi<a class="headerlink" href="#uwsgi" title="Permanent link">&para;</a></h4>
<p>uwsgi_pass</p>
<h4 id="scgi">SCGI<a class="headerlink" href="#scgi" title="Permanent link">&para;</a></h4>
<p>scgi_pass</p>
<h4 id="memcached">memcached<a class="headerlink" href="#memcached" title="Permanent link">&para;</a></h4>
<p>memcached_pass</p>
<h4 id="named-group">named group（即负载均衡）<a class="headerlink" href="#named-group" title="Permanent link">&para;</a></h4>
<p><a href="https://www.nginx.com/resources/admin-guide/load-balancer/">https://www.nginx.com/resources/admin-guide/load-balancer/</a></p>
<h3 id="_40">修改转发请求头部<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<p>默认会删除内容为空的header fields，设置"Host"为$proxy_host，"Connection"为"close"。</p>
<h4 id="proxy_set_header">proxy_set_header<a class="headerlink" href="#proxy_set_header" title="Permanent link">&para;</a></h4>
<p>语法：proxy_set_header field value;<br />
默认：proxy_set_header Host $proxy_host;<br />
          proxy_set_header Connection close;<br />
上下文：http, server, location  </p>
<h4 id="hosthost">设置Host为原始Host<a class="headerlink" href="#hosthost" title="Permanent link">&para;</a></h4>
<p>proxy_set_header Host $host;  </p>
<h4 id="ipip">设置真实IP为原始IP<a class="headerlink" href="#ipip" title="Permanent link">&para;</a></h4>
<p>proxy_set_header X-Real-IP $remote_addr;  </p>
<h4 id="_41">阻止某个字段传给代理（设置为空）<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h4>
<p>proxy_set_header Accept-Encoding "";   </p>
<h3 id="_42">配置缓存<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<h4 id="proxy_buffering">proxy_buffering（开关）<a class="headerlink" href="#proxy_buffering" title="Permanent link">&para;</a></h4>
<p>语法：proxy_buffering on | off;<br />
默认：proxy_buffering on;<br />
上下文：http, server, location  </p>
<h4 id="proxy_buffers">proxy_buffers（单连接缓存大小块数）<a class="headerlink" href="#proxy_buffers" title="Permanent link">&para;</a></h4>
<p>语法：proxy_buffers number size;<br />
默认：proxy_buffers 8 4k|8k;<br />
上下文：http, server, location  </p>
<h4 id="proxy_buffer_size">proxy_buffer_size（响应读取阈值）<a class="headerlink" href="#proxy_buffer_size" title="Permanent link">&para;</a></h4>
<p>语法：proxy_buffer_size size;<br />
默认：proxy_buffer_size 4k|8k;<br />
上下文：http, server, location  </p>
<h4 id="proxy_buffer">低延迟交互应用时关闭proxy_buffer（同步处理）<a class="headerlink" href="#proxy_buffer" title="Permanent link">&para;</a></h4>
<p>proxy_buffering off;  </p>
<h3 id="ip_1">绑定出口IP<a class="headerlink" href="#ip_1" title="Permanent link">&para;</a></h3>
<h4 id="ip_2">绑定IP<a class="headerlink" href="#ip_2" title="Permanent link">&para;</a></h4>
<p>proxy_bind 127.0.0.1;  </p>
<h4 id="_43">绑定变量<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h4>
<p>proxy_bind $server_addr;  </p>
<h2 id="content-caching">内容缓存 Content Caching<a class="headerlink" href="#content-caching" title="Permanent link">&para;</a></h2>
<p><a href="https://www.nginx.com/resources/admin-guide/content-caching/">https://www.nginx.com/resources/admin-guide/content-caching/</a></p>
<h3 id="_44">开启响应缓存<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<h4 id="proxy_cache">proxy_cache 开启或关闭代理缓存<a class="headerlink" href="#proxy_cache" title="Permanent link">&para;</a></h4>
<p>语法：proxy_cache zone | off;<br />
默认：proxy_cache off;<br />
上下文：http, server, location  </p>
<h4 id="proxy_cache_path">proxy_cache_path 定义缓存区<a class="headerlink" href="#proxy_cache_path" title="Permanent link">&para;</a></h4>
<p>语法：proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];<br />
默认：N/A <br />
上下文：http  </p>
<h4 id="keys_zone">keys_zone # 定义缓存区名称，大小，超时时间，<a class="headerlink" href="#keys_zone" title="Permanent link">&para;</a></h4>
<p>proxy_cache_path /path/to/cache keys_zone=one:10m  </p>
<p>这个大小是key存储空间大小，不是数据存储空间大小，1m约能存储8k个key。  </p>
<h4 id="levels">levels # 指定缓存子目录数<a class="headerlink" href="#levels" title="Permanent link">&para;</a></h4>
<p>假设设置为levels=1:2 <br />
缓存文件key为b7f54b2df7773722d382f4809d65029c<br />
nginx会取key最后1个字符c为一级目录，再取倒数2、3个字符29为二级目录<br />
最多设置三级目录 levels=2:2:2  </p>
<h4 id="inactive">inactive<a class="headerlink" href="#inactive" title="Permanent link">&para;</a></h4>
<p>不访问老化时间  </p>
<h4 id="use_temp_path">use_temp_path<a class="headerlink" href="#use_temp_path" title="Permanent link">&para;</a></h4>
<p>默认会先把文件写入临时目录（proxy_temp_path），若临时目录与缓存目录不在同一个文件系统，会造成两次文件写入<br />
建议设置为off  </p>
<h3 id="_45">设置缓存加载<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h3>
<p>一次加载过多会影响启动速度和性能  </p>
<h4 id="loader_threshold">loader_threshold<a class="headerlink" href="#loader_threshold" title="Permanent link">&para;</a></h4>
<p>遍历时间阈值，默认200millliseconds  </p>
<h4 id="loader_files">loader_files<a class="headerlink" href="#loader_files" title="Permanent link">&para;</a></h4>
<p>遍历文件阈值，默认100  </p>
<h4 id="loader_sleeps">loader_sleeps<a class="headerlink" href="#loader_sleeps" title="Permanent link">&para;</a></h4>
<p>遍历间隔事件，默认50毫秒  </p>
<h4 id="_46">示例<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">proxy_cache_path /path/to/cache keys_zone=one:10m loader_threshold=300 loader_files=200</code></pre>


<h3 id="_47">缓存设置<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h3>
<h4 id="key">设置缓存key计算方法<a class="headerlink" href="#key" title="Permanent link">&para;</a></h4>
<p>proxy_cache_key "$host$request_uri$cookie_user";  </p>
<h4 id="_48">设置缓存条件：最小请求次数（只有被最常访问的数据才被缓存）<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h4>
<p>proxy_cache_min_users 5;  </p>
<h4 id="methods">设置缓存methods<a class="headerlink" href="#methods" title="Permanent link">&para;</a></h4>
<p>proxy_cache_methods GET HEAD POST<br />
默认只缓存GET和HEAD方法  </p>
<h4 id="_49">缓存更新锁<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h4>
<p>语法：proxy_cache_lock on|off;<br />
默认：proxy_cache_lock off;<br />
上下文：http, server, location<br />
当多个客户端同时请求一个缓存中不存在的文件时，只有当请求中第一个请求得到正确缓存数据后，其他请求才得到相应。<br />
默认关闭，所有客户端都会与后端通信。  </p>
<h4 id="_50">使用缓存替代错误相应<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h4>
<p>proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;  </p>
<h4 id="_51">缓存正在更新时，先发送旧内容，触发更新的请求会等待服务器返回新结果<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h4>
<p>proxy_cache_use_stale updating  </p>
<h3 id="_52">限制或绕过缓存<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<p>默认缓存永久缓存，超过限制按最近最少访问老化  </p>
<h4 id="_53">设置缓存过期时间<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h4>
<p>proxy_cache_valid any           5m;  </p>
<h4 id="_54">按状态码设置缓存过期时间<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h4>
<p>proxy_cache_valid 200 302 10m;<br />
proxy_cache_valid 404          1m;  </p>
<h4 id="string-0">如果有string参数为空 或 值参数不等于0 则不缓存<a class="headerlink" href="#string-0" title="Permanent link">&para;</a></h4>
<p>proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;  </p>
<h4 id="string-0_1">如果有string不为空 或 值不等于0 则不缓存<a class="headerlink" href="#string-0_1" title="Permanent link">&para;</a></h4>
<p>proxy_no_cache $cookie_nocache $arg_nocache$arg_comment;  </p>
<h3 id="purge">缓存手动老化 PURGE<a class="headerlink" href="#purge" title="Permanent link">&para;</a></h3>
<h3 id="_55">缓存分段<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h3>
<h3 id="_56">综合配置示例<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h3>
<h2 id="_57">静态文件<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h2>
<p><a href="https://www.nginx.com/resources/admin-guide/serving-static-content/">https://www.nginx.com/resources/admin-guide/serving-static-content/</a></p>
<h3 id="rootindex">root目录和Index文件<a class="headerlink" href="#rootindex" title="Permanent link">&para;</a></h3>
<h4 id="root_1">root使用示例<a class="headerlink" href="#root_1" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">server {
    root /www/data;

    location / {
        # 路径为root的路径：/www/data
    }

    location /images/ {
        # 路径为root的路径+目录的路径：/www/data/image/
    }

    location ~ \.(mp3|mp4) {
        # 路径被覆盖为：/www/media
        root /www/media;
    }
}</code></pre>


<h4 id="location_3">以斜杠"\"结尾的location<a class="headerlink" href="#location_3" title="Permanent link">&para;</a></h4>
<p>以斜杠"\"结尾的location会被认为是目录，nginx会试图在其中找到index.html文件<br />
如：假设URI为/images/some/path/，nginx会寻找/www/data/images/some/path/index.html  </p>
<h4 id="autoindex-indexhtml">autoindex 自动创建index.html<a class="headerlink" href="#autoindex-indexhtml" title="Permanent link">&para;</a></h4>
<p>语法：autoindex on | off;<br />
默认：autoindex off;<br />
上下文:http, server, location  </p>
<h4 id="index-index">index 定义index文件名称<a class="headerlink" href="#index-index" title="Permanent link">&para;</a></h4>
<p>语法：index index_file;  </p>
<h3 id="try_file">try_file<a class="headerlink" href="#try_file" title="Permanent link">&para;</a></h3>
<h4 id="_58">不存在则重定向到默认<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location /images/ {
    try_files $uri /images/default.gif;
}</code></pre>


<h4 id="404">尝试一系列形式，不存在则404<a class="headerlink" href="#404" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location / {
    try_files $uri $uri/ $uri.html =404;
}</code></pre>


<h4 id="proxy">找不到文件则转到proxy<a class="headerlink" href="#proxy" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location / {
    try_files $uri $uri/ @backend;
}</code></pre>


<pre class="codehilite"><code class="language-nginx">location @backend {
    proxy_pass http://backend.example.com;
}</code></pre>


<h3 id="_59">性能优化<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h3>
<h4 id="send_file_1">send_file 直接发送文件<a class="headerlink" href="#send_file_1" title="Permanent link">&para;</a></h4>
<p>语法：sendfile on | off;<br />
默认：sendfile off;<br />
上下文：http, server, location, if in location<br />
默认nginx会把文件copy到内存后再发送，打开send_file后会直接从文件fd复制到socket fd。  </p>
<h4 id="sendfile_max_chunk">sendfile_max_chunk 最大一次发送数据量<a class="headerlink" href="#sendfile_max_chunk" title="Permanent link">&para;</a></h4>
<p>语法：sendfile_max_chunk size;<br />
默认：sendfile_max_chunk 0;<br />
上下文：http, server, location<br />
为防止nginx被特大文件占用，需要限制每次最大发送分段为1m  </p>
<h4 id="tcp_nopush_1">tcp_nopush<a class="headerlink" href="#tcp_nopush_1" title="Permanent link">&para;</a></h4>
<p>语法：tcp_nopush on | off;<br />
默认：tcp_nopush off;<br />
上下文：http, server, location  </p>
<p>在一个包中发送响应头和文件<br />
数据包累积满时才发送<br />
依赖于sendfile打开  </p>
<h4 id="tcp_nodelay">tcp_nodelay<a class="headerlink" href="#tcp_nodelay" title="Permanent link">&para;</a></h4>
<p>语法：tcp_nodelay on | off;<br />
默认：tcp_nodelay on;<br />
上下文：http, server, location  </p>
<h4 id="tcp">增加tcp监听队列长度<a class="headerlink" href="#tcp" title="Permanent link">&para;</a></h4>
<p>查看队列长度方法：  </p>
<pre class="codehilite"><code class="language-sh">netstat -Lan   </code></pre>


<p>临时修改操作系统参数：  </p>
<pre class="codehilite"><code class="language-sh">sudo sysctl -w net.core.somaxconn=4096</code></pre>


<p>永久修改操作系统参数：<br />
为文件/etc/sysctl.conf添加  </p>
<pre class="codehilite"><code>net.core.somaxconn = 4096</code></pre>


<p>修改nginx配置，一般应大于512：  </p>
<pre class="codehilite"><code class="language-nginx">listen 80 backlog 4096;</code></pre>


<h2 id="_60">正向代理配置示例<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-nginx">server{  
        # 不能设置hostname

        # 设置dns及超时时间
        resolver 8.8.8.8;  
        resolver_timeout 30s;   

        # 监听端口
        listen 82;  
        location / {  
                # 代理参数
                proxy_pass http://$http_host$request_uri;  
                proxy_set_header Host $http_host;  

                # 配置缓存大小
                proxy_buffers 256 4k;  

                # 关闭磁盘缓存
                proxy_max_temp_file_size 0;  

                # 配置代理服务器http状态缓存时间
                proxy_connect_timeout 30;  
                proxy_cache_valid 200 302 10m;  
                proxy_cache_valid 301 1h;  
                proxy_cache_valid any 1m;  
        }  
}</code></pre>


<h2 id="_61">反向代理配置示例<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h2>
<h4 id="1">例1：<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">location / {
    proxy_pass      http://192.168.18.201:8080;
    proxy_set_header  X-Real-IP  $remote_addr; # 设置代理转发保留用户ip
}</code></pre>


<h4 id="2">例2：<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">server {  
    listen    80;  
    server_name www.test.com;  
    location / {  
        proxy_pass http://8.8.8.8:80;  
    }  
}  </code></pre>


<h4 id="3">例3：<a class="headerlink" href="#3" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">http {  

    # 负载均衡地址池
    upstream http_server_pool {  
        server 192.168.1.2:8080 weight=2 max_fails=2 fail_timeout=30s;  
        server 192.168.1.3:8080 weight=3 max_fails=2 fail_timeout=30s;  
        server 192.168.1.4:8080 weight=4 max_fails=2 fail_timeout=30s;  
    }

    # 一个虚拟主机，用来反向代理http_server_pool这组服务器  
    server {  
        listen       80;  
        # 外网访问的域名          
        server_name  www.test.com;   
        location / {  
            # 后端服务器返回500 503 404错误，自动请求转发到upstream池中另一台服务器  
            proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;  
            proxy_pass http://http_server_pool;  
            proxy_set_header Host www.test.com;  
            proxy_set_header X-Real-IP $remote_addr;  
            proxy_set_header X-Forwarded-For  $proxy_add_x_forwarded_for;  
        }  
        access_log  logs/www.test.com.access.log  combined;  
    }
}</code></pre>


<h2 id="ssl">ssl<a class="headerlink" href="#ssl" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/docs/http/configuring_https_servers.html">http://nginx.org/en/docs/http/configuring_https_servers.html</a></p>
<h4 id="ssl_protocols-ssl">ssl_protocols SSL协议<a class="headerlink" href="#ssl_protocols-ssl" title="Permanent link">&para;</a></h4>
<p>语法：ssl_protocols [protocol]<br />
默认：TLSv1 TLSv1.1 TLSv1.2 <br />
默认值即可  </p>
<h4 id="ssl_ciphers-ssl">ssl_ciphers SSL加密<a class="headerlink" href="#ssl_ciphers-ssl" title="Permanent link">&para;</a></h4>
<p>语法：ssl_ciphers []<br />
默认：ssl_ciphers HIGH:!aNULL:!MD5<br />
默认值即可  </p>
<h4 id="ssl_session_cache-sslcache">ssl_session_cache SSL会话Cache性能优化<a class="headerlink" href="#ssl_session_cache-sslcache" title="Permanent link">&para;</a></h4>
<p>语法：ssl_session_cache shared:SSL:10m;<br />
默认：<br />
1m Cache约4000个会话。  </p>
<h4 id="ssl_session_time-ssl">ssl_session_time SSL会话超时时间<a class="headerlink" href="#ssl_session_time-ssl" title="Permanent link">&para;</a></h4>
<p>语法：ssl_session_time [time]<br />
默认：5分钟<br />
可以增加会话时间以优化。  </p>
<h4 id="crt">为缺少中间证书的浏览器添加crt中间证书<a class="headerlink" href="#crt" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">cat www.example.com.crt bundle.crt &gt; www.example.com.chained.crt  </code></pre>


<p>需要保证顺序正确，自己证书在最前  </p>
<h4 id="_62">配置示例<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-nginx">server {
    listen     443 ssl;
    ssl         on;

    ssl_certificate      @SSL_CERT@; # 证书，公开
    ssl_certificate_key  @SSL_KEY@; # 密钥，不公开

    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout  10m;

    ssl_prefer_server_ciphers   on;
}</code></pre>


<h4 id="_63">消息转发<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h4>
<p>所有http转发到https：  </p>
<pre class="codehilite"><code class="language-nginx">server {
    listen  80;
    server_name yingxuanxuan.com;

    rewrite ^(.*)$  https://$host$1 permanent;
}
···

nginx http错误497转发至https：  
``` nginx
error_page 497  https://$host$uri?$args;    </code></pre>


<p>非登陆页面使用http：  </p>
<pre class="codehilite"><code class="language-nginx">if ($uri !~* &quot;/logging.php$&quot;)
{
    rewrite ^/(.*)$ http://$host/$1 redirect;
}</code></pre>


<p>登录页面使用https：  </p>
<pre class="codehilite"><code class="language-nginx">if ($uri ~* &quot;/logging.php$&quot;)
{
    rewrite ^/(.*)$ https://$host/$1 redirect;
}</code></pre>


<h4 id="_64">生成方法<a class="headerlink" href="#_64" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-sh">openssl req -newkey rsa:2048 -keyout yourname.key -out yourname.csr   </code></pre>


<p>CN/Shannxi/Xian/Yingxuanxuan Ltd/Yingxuanxuan/*.yingxuanxuan.com/yingxuanxuan@hotmail.com <br />
extra部分直接回车   </p>
<h4 id="_65">分解生成方法<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h4>
<p>生成RSA密钥：  </p>
<pre class="codehilite"><code class="language-sh">openssl genrsa -des3-out 33iq.key 1024</code></pre>


<p>复制一个无密码密钥：  </p>
<pre class="codehilite"><code class="language-sh">openssl rsa -in 33iq.key -out 33iq_nopass.key</code></pre>


<p>生成一个证书请求：  </p>
<pre class="codehilite"><code class="language-sh">openssl req -new-key 33iq.key -out 33iq.csr</code></pre>


<p>自己签发证书（不安全连接）：  </p>
<pre class="codehilite"><code class="language-sh">openssl x509 -req-days365-in 33iq.csr -signkey 33iq.key -out 33iq.crt</code></pre>


<h2 id="_66">负载均衡<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/docs/http/load_balancing.html">http://nginx.org/en/docs/http/load_balancing.html</a><br />
<a href="https://www.nginx.com/resources/admin-guide/load-balancer/">https://www.nginx.com/resources/admin-guide/load-balancer/</a></p>
<h4 id="dns">DNS负载均衡<a class="headerlink" href="#dns" title="Permanent link">&para;</a></h4>
<p>将相同域名配置到不同IP即可</p>
<h2 id="_67">重定向<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/docs/http/converting_rewrite_rules.html">http://nginx.org/en/docs/http/converting_rewrite_rules.html</a></p>
<h2 id="websocket">websocket代理<a class="headerlink" href="#websocket" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/docs/http/websocket.html">http://nginx.org/en/docs/http/websocket.html</a></p>
<h2 id="nginx-httl-hls-module">nginx httl hls module<a class="headerlink" href="#nginx-httl-hls-module" title="Permanent link">&para;</a></h2>
<p><a href="http://nginx.org/en/docs/http/ngx_http_hls_module.html">http://nginx.org/en/docs/http/ngx_http_hls_module.html</a></p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../linux/" title="Linux" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Linux
              </span>
            </div>
          </a>
        
        
          <a href="../nginx-vod-module/" title="Nginx-vod-module" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Nginx-vod-module
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Yingxuanxuan.com
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/yingxuanxuan" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/yingxuanxuan_g" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-f7ac33b6fb.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-92401539-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>